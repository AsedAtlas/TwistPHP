/**
 * This file is part of TwistPHP.
 *
 * TwistPHP is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TwistPHP is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with TwistPHP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>
 * @license    https://www.gnu.org/licenses/gpl.html LGPL License
 * @link       https://twistphp.com
 *
 * Twist AJAX
 * --------------
 * @version 3.0.0
 */

try{if(!$)throw"Twist AJAX requires jQuery to run";!function(t,e,n){var o=function(t,e,n){return n="boolean"==typeof n?n:!1,n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},a=function(t,e){return i()&&Object.prototype.hasOwnProperty.call(t,e)||t.hasOwnProperty(e)},r=function(t){return""==t.replace(/[\s\t\r\n]*/g,"")},i=function(){return navigator.userAgent.indexOf("MSIE ")};isNull=function(t){return"null"==typeof t||null===t},log=function(){var e=arguments;if(t.console&&t.console.log&&e.length>0)for(var n in e)t.console.log(e[n])},objectLength=function(t){var e=0;if("object"==typeof t)for(var n in t)a(t,n)&&e++;return e},prettySize=function(t,e){for(var n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],o=0;n[o]&&t>Math.pow(1024,o+1);)o++;return round(t/Math.pow(1024,o),2)+("boolean"==typeof e&&e?" ":"")+n[o]},round=function(t,e){return e="number"!=typeof e?0:e,0===e?parseInt(Math.round(t*Math.pow(10,e))/Math.pow(10,e)):parseFloat(Math.round(t*Math.pow(10,e))/Math.pow(10,e))},serializeJSON=function(t){var e={},a=[];jQuery.map(t.serializeArray(),function(t){a.push({name:t.name,value:t.value})}),t.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var t=n(this);a.push({name:t.attr("name"),value:t.val()})});var i=function(t,e,s,u){var f={},c=s.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(c){var l=c[2];if(r(l)){var p=1,y=!0;do{var d=!0;if(n.each(a,function(t,n){o(e+"["+p+"]",n.name)&&(p++,d=!1)}),d){var h=!1;n.each(a,function(t,n){h||n.name!==e+"[]"||n.value!==u||(a[t].name=e+"["+p+"]",h=!0)}),y=!1}}while(y);l=p}f[l]=c[3]?i(t,e+"["+l+"]",c[3],u):u}return f};return n.each(a,function(t,o){var a=o.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(a){var r={};r[a[1]]=i(o.name,a[1],a[2],o.value),e=n.extend(!0,e,r)}else e[o.name]=o.value}),e};var s=function(o,r,i,s,u,f){var c=function(){},l=function(){},p={},y=1e4,d="medium";if("string"!=typeof o||""==o)throw new Error("Need to specify a valid AJAX post location");"function"==typeof r?(c=r,"function"==typeof i?(l=i,"object"==typeof s?(p=s,"number"==typeof u?(y=u,"string"==typeof f&&(d=f)):"string"==typeof u&&(d=u)):"number"==typeof s?(y=s,"string"==typeof u&&(d=u)):"string"==typeof s&&(d=s)):"object"===i?(p=i,"number"==typeof s?(y=s,"string"==typeof u&&(d=u)):"string"==typeof s&&(d=s)):"number"===i?(y=i,"string"==typeof s&&(d=s)):"string"==typeof i&&(d=i)):"object"==typeof r?(p=r,"number"==typeof i?(y=i,"string"==typeof s&&(d=s)):"string"==typeof i&&(d=i)):"number"==typeof r?(y=r,"string"==typeof i&&(d=i)):"string"==typeof r&&(d=r),n.ajaxSetup({url:o,timeout:y});var h=this;return this.count=0,this.defaultArray=p,this.disableLoader=function(){return h.showLoader=!1,h},this.enableLoader=function(){return h.showLoader=!0,h},this.loaderSize=function(t){return n("#twist-ajax-loader").length&&n("#twist-ajax-loader").attr("class","").addClass(t),d=t,h},this.onfail=function(t){var e="string"==typeof t&&""!==t?t:"An unexpected AJAX response was given";return log(e),h},this.send=function(t,e,r,i,s){h.count++,n("#twist-ajax-loader-size").text("Loading..."),h.count>1&&n("#twist-ajax-loader-count").text(h.count),h.showLoader&&n("#twist-ajax-loader").stop().show().fadeTo(0,1);var u={foo:"bar"},f=y,p=function(){},d=function(){};"object"==typeof e||"string"==typeof e&&/^\#[0-9a-z_\-]+$/i.test(e)&&(n(e)instanceof jQuery||e.jquery)?(u="object"==typeof e?e instanceof jQuery||e.jquery?serializeJSON(e):0===objectLength(e)?u:e:serializeJSON(n(e)),"number"==typeof r?(f=r,"function"==typeof i&&(p=i,"function"==typeof s&&(d=s))):"function"==typeof r&&(p=r,"function"==typeof i&&(d=i))):"number"==typeof e?(f=e,"function"==typeof r&&(p=r,"function"==typeof i&&(d=i))):"function"==typeof e&&(p=e,"function"==typeof r&&(d=r));var g=function(t){try{p.call(t),c.call(t)}catch(e){log(e)}},w=function(t){try{d.call(t),l.call(t)}catch(e){log(e)}},m={"function":t,data:u};n.each(h.defaultArray,function(t,e){m[t]=e});var v=((new Date).getTime(),n.ajax({type:"POST",url:o,data:m,dataType:"json",timeout:f,global:!0,cache:!1,complete:function(){h.count--,0===h.count?n("#twist-ajax-loader").stop().fadeTo(200,0,function(){n(this).hide()}):n("#twist-ajax-loader-count").text(h.count>1?h.count:"")},success:function(t,e,o){var r=prettySize(o.getResponseHeader("Content-Length"));n("#twist-ajax-loader-size").text("Downloading "+r+"..."),!isNull(t)&&"object"==typeof t&&a(t,"status")&&t.status===!0?g(t):w(t)},error:function(e,a,r){switch(a){case"abort":w(),n("#twist-ajax-loader-size").text("Aborted"),log("The AJAX request was aborted");break;case"timeout":w(),n("#twist-ajax-loader-size").text("Timeout"),log("The AJAX request timed out");break;case"parsererror":var i=/{"status":(true|false),"message":"[^"]*","title":"[^"]*","data":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*,"sticky":(true|false),"importance":\d+,"loggedin":(true|false),"login_redirect":(true|false),"output":"[^"]*"}/,s=prettySize(e.getResponseHeader("Content-Length")),u="==============================================================================================",c="undefined"!=typeof JSON?"\nPost              "+JSON.stringify(m):"";if(log(u+"\nDate              "+e.getResponseHeader("Date")+"\nLocation          "+o+"\nFunction          "+t+"\nTimeout           "+f/1e3+"s\nResponse length   "+s+c+"\n"+u+"\n"+e.responseText.replace(i,"")),e.responseText.match(i)){var l=e.responseText.match(i)[0];if(null!==n.parseJSON(l)){var p=n.parseJSON(l);"object"==typeof p&&"status"in p&&p.status===!0?g(p):w(p)}else{w();try{h.onfail(r)}catch(y){log(y)}}}else{w();try{h.onfail(r)}catch(y){log(y)}}break;default:w(),n("#twist-ajax-loader-size").text("Error");try{h.onfail(r)}catch(y){log(y)}}}}));return v},this.showLoader=!0,n(e).ready(function(){n("body").prepend('<div id="twist-ajax-loader" class="'+d+'"><span id="twist-ajax-loader-count"></span><span id="twist-ajax-loader-size"></span></div>')}),t.TwistAJAXSessions.push(this),!0};t.TwistAJAX=function(t,e,n,o){return new s(t,e,n,o)},t.TwistAJAXSessions||(t.TwistAJAXSessions=[])}(window,document,jQuery)}catch(err){window.console&&window.console.log&&console.log(err)}