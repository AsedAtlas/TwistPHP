/**
 * This file is part of TwistPHP.
 *
 * TwistPHP is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TwistPHP is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with TwistPHP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>
 * @license    https://www.gnu.org/licenses/gpl.html LGPL License
 * @link       https://twistphp.com
 *
 * Twist AJAX
 * --------------
 * @version 3.0.0
 */

try{if(!$)throw"Twist AJAX requires jQuery to run";!function(t,e,n){var o=function(t,e,n){return n="boolean"==typeof n?n:!1,n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},a=function(t,e){return i()&&Object.prototype.hasOwnProperty.call(t,e)||t.hasOwnProperty(e)},r=function(t){return""==t.replace(/[\s\t\r\n]*/g,"")},i=function(){return navigator.userAgent.indexOf("MSIE ")},u=function(){var e=arguments;if(t.console&&t.console.log&&e.length>0)for(var n in e)t.console.log(e[n])},s=function(t){var e=0;if("object"==typeof t)for(var n in t)a(t,n)&&e++;return e},f=function(t,e){for(var n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],o=0;n[o]&&t>Math.pow(1024,o+1);)o++;return c(t/Math.pow(1024,o),2)+("boolean"==typeof e&&e?" ":"")+n[o]},c=function(t,e){return e="number"!=typeof e?0:e,0===e?parseInt(Math.round(t*Math.pow(10,e))/Math.pow(10,e)):parseFloat(Math.round(t*Math.pow(10,e))/Math.pow(10,e))},p=function(t){var e={},a=[];jQuery.map(t.serializeArray(),function(t){a.push({name:t.name,value:t.value})}),t.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var t=n(this);a.push({name:t.attr("name"),value:t.val()})});var i=function(t,e,u,s){var f={},c=u.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(c){var p=c[2];if(r(p)){var l=1,y=!0;do{var d=!0;if(n.each(a,function(t,n){o(e+"["+l+"]",n.name)&&(l++,d=!1)}),d){var h=!1;n.each(a,function(t,n){h||n.name!==e+"[]"||n.value!==s||(a[t].name=e+"["+l+"]",h=!0)}),y=!1}}while(y);p=l}f[p]=c[3]?i(t,e+"["+p+"]",c[3],s):s}return f};return n.each(a,function(t,o){var a=o.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(a){var r={};r[a[1]]=i(o.name,a[1],a[2],o.value),e=n.extend(!0,e,r)}else e[o.name]=o.value}),e},l=function(t,o,r,i,c,l){var y=function(){},d=function(){},h={},w=1e4,v="medium",g=!1,m=!0;if("string"!=typeof t||""==t)throw new Error("Need to specify a valid AJAX post location");t=t.replace(/\/$/,""),"function"==typeof o?(y=o,"function"==typeof r?(d=r,"object"==typeof i?(h=i,"number"==typeof c?(w=c,"string"==typeof l&&(v=l)):"string"==typeof c&&(v=c)):"number"==typeof i?(w=i,"string"==typeof c&&(v=c)):"string"==typeof i&&(v=i)):"object"===r?(h=r,"number"==typeof i?(w=i,"string"==typeof c&&(v=c)):"string"==typeof i&&(v=i)):"number"===r?(w=r,"string"==typeof i&&(v=i)):"string"==typeof r&&(v=r)):"object"==typeof o?(h=o,"number"==typeof r?(w=r,"string"==typeof i&&(v=i)):"string"==typeof r&&(v=r)):"number"==typeof o?(w=o,"string"==typeof r&&(v=r)):"string"==typeof o&&(v=o),n.ajaxSetup({url:t,timeout:w});var b=this,j=function(e,o,r,i,c,l,h){b.count++,o="string"==typeof o?o:"POST",n("#twist-ajax-loader-size").text("Loading..."),b.count>1&&n("#twist-ajax-loader-count").text(b.count),m&&n("#twist-ajax-loader").stop().show().fadeTo(0,1);var v={},g=w,j=function(){},x=function(){};"object"==typeof i||"string"==typeof i&&/^\#[0-9a-z_\-]+$/i.test(i)&&(n(i)instanceof jQuery||i.jquery)?(v="object"==typeof i?i instanceof jQuery||i.jquery?p(i):0===s(i)?v:i:p(n(i)),"number"==typeof c?(g=c,"function"==typeof l&&(j=l,"function"==typeof h&&(x=h))):"function"==typeof c&&(j=c,"function"==typeof l&&(x=l))):"number"==typeof i?(g=i,"function"==typeof c&&(j=c,"function"==typeof l&&(x=l))):"function"==typeof i&&(j=i,"function"==typeof c&&(x=c));var A=function(t){try{j.call(t),y.call(t)}catch(e){u(e)}},T=function(t){try{x.call(t),d.call(t)}catch(e){u(e)}};n.each(b.defaultArray,function(t,e){v[t]=e});var O=((new Date).getTime(),t+"/"+e.replace(/^\//,"")),E=n.ajax({type:o.toUpperCase(),url:O,data:v,dataType:"json",timeout:g,global:!0,cache:r,complete:function(){b.count--,0===b.count?n("#twist-ajax-loader").stop().fadeTo(200,0,function(){n(this).hide()}):n("#twist-ajax-loader-count").text(b.count>1?b.count:"")},success:function(t,e,o){var r=f(o.getResponseHeader("Content-Length"));n("#twist-ajax-loader-size").text("Downloading "+r+"..."),t&&"object"==typeof t&&a(t,"status")&&t.status===!0?A(t):T(t)},error:function(t,e,o){switch(e){case"abort":T(),n("#twist-ajax-loader-size").text("Aborted"),u("The AJAX request was aborted");break;case"timeout":T(),n("#twist-ajax-loader-size").text("Timeout"),u("The AJAX request timed out");break;case"parsererror":var a=/{"status":(true|false),"message":"[^"]*","data":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*(,"debug":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*)?}/,r=f(t.getResponseHeader("Content-Length")),i="===============================================";if(u(i+"\nPARSER ERROR RECOVERY\n"+i+"\nDate:             "+t.getResponseHeader("Date")+"\nLocation:         "+O+"\nTimeout:          "+g/1e3+"s\nResponse length:  "+r+("undefined"!=typeof JSON?"\nPost data:        "+JSON.stringify(v):"{}")+"\n"+i),a.test(t.responseText)){var s=t.responseText.match(a)[0];if(null!==n.parseJSON(s)){var c=n.parseJSON(s);"object"==typeof c&&"status"in c&&c.status===!0?A(c):T(c)}else{T();try{b.onfail(o)}catch(p){u(p)}}}else{T();try{b.onfail(o)}catch(p){u(p)}}break;default:T(),n("#twist-ajax-loader-size").text("Error");try{b.onfail(o)}catch(p){u(p)}}}});return E};return this.count=0,this.defaultArray=h,this["delete"]=function(t,e,n,o,a){return j(t,"DELETE",g,e,n,o,a),b},this.disableCache=function(){return g=!1,b},this.disableLoader=function(){return m=!1,b},this.enableCache=function(){return g=!0,b},this.enableLoader=function(){return m=!0,b},this.get=function(t,e,n,o,a){return j(t,"GET",g,e,n,o,a),b},this.loaderSize=function(t){return n("#twist-ajax-loader").length&&n("#twist-ajax-loader").attr("class","").addClass(t),v=t,b},this.onfail=function(t){var e="string"==typeof t&&""!==t?t:"An unexpected AJAX response was given";return u(e),b},this.patch=function(t,e,n,o,a){return j(t,"PATCH",g,e,n,o,a),b},this.post=function(t,e,n,o,a){return j(t,"POST",g,e,n,o,a),b},this.put=function(t,e,n,o,a){return j(t,"PUT",g,e,n,o,a),b},n(e).ready(function(){n("body").prepend('<div id="twist-ajax-loader" class="'+v+'"><span id="twist-ajax-loader-count"></span><span id="twist-ajax-loader-size"></span></div>')}),!0};t.TwistAJAX=function(t,e,n,o){return new l(t,e,n,o)}}(window,document,jQuery)}catch(err){window.console&&window.console.log&&console.log(err)}