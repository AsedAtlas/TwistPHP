/**
 * This file is part of TwistPHP.
 *
 * TwistPHP is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TwistPHP is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with TwistPHP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>
 * @license    https://www.gnu.org/licenses/gpl.html LGPL License
 * @link       https://twistphp.com
 *
 * Twist AJAX
 * --------------
 * @version 3.0.0
 */

!function(t,e){"function"==typeof define&&define.amd?define(["postal"],function(n){return t.twistajax=e(n)}):"object"==typeof module&&module.exports?module.exports=t.twistajax=e(require("postal")):t.twistajax=e(t.postal)}(this,function(){try{if(window.jQuery){var t=function(t,e,n,o,a,r){var i=this,u=function(t,e,n){return n="boolean"==typeof n?n:!1,n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},s=function(t,e){return c()&&Object.prototype.hasOwnProperty.call(t,e)||t.hasOwnProperty(e)},f=function(t){return""==t.replace(/[\s\t\r\n]*/g,"")},c=function(){return navigator.userAgent.indexOf("MSIE ")},p=function(){var t=arguments;if(window.console&&window.console.log&&t.length>0)for(var e in t)window.console.log(t[e])},l=function(t){var e=0;if("object"==typeof t)for(var n in t)s(t,n)&&e++;return e},d=function(t,e){for(var n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],o=0;n[o]&&t>Math.pow(1024,o+1);)o++;return y(t/Math.pow(1024,o),2)+("boolean"==typeof e&&e?" ":"")+n[o]},y=function(t,e){return e="number"!=typeof e?0:e,0===e?parseInt(Math.round(t*Math.pow(10,e))/Math.pow(10,e)):parseFloat(Math.round(t*Math.pow(10,e))/Math.pow(10,e))},h=function(t){var e={},n=[];jQuery.map(t.serializeArray(),function(t){n.push({name:t.name,value:t.value})}),t.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var t=$(this);n.push({name:t.attr("name"),value:t.val()})});var o=function(t,e,a,r){var i={},s=a.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(s){var c=s[2];if(f(c)){var p=1,l=!0;do{var d=!0;if($.each(n,function(t,n){u(e+"["+p+"]",n.name)&&(p++,d=!1)}),d){var y=!1;$.each(n,function(t,o){y||o.name!==e+"[]"||o.value!==r||(n[t].name=e+"["+p+"]",y=!0)}),l=!1}}while(l);c=p}i[c]=s[3]?o(t,e+"["+c+"]",s[3],r):r}return i};return $.each(n,function(t,n){var a=n.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(a){var r={};r[a[1]]=o(n.name,a[1],a[2],n.value),e=$.extend(!0,e,r)}else e[n.name]=n.value}),e},w=function(){},m=function(){},g={},v=1e4,b="medium",j=!1,x=!0,A=function(e,n,o,a,r,u,f){i.count++,n="string"==typeof n?n:"POST",$("#twist-ajax-loader-size").text("Loading..."),i.count>1&&$("#twist-ajax-loader-count").text(i.count),x&&$("#twist-ajax-loader").stop().show().fadeTo(0,1);var c={},y=v,g=function(){},b=function(){};"object"==typeof a||"string"==typeof a&&/^\#[0-9a-z_\-]+$/i.test(a)&&($(a)instanceof jQuery||a.jquery)?(c="object"==typeof a?a instanceof jQuery||a.jquery?h(a):0===l(a)?c:a:h($(a)),"number"==typeof r?(y=r,"function"==typeof u&&(g=u,"function"==typeof f&&(b=f))):"function"==typeof r&&(g=r,"function"==typeof u&&(b=u))):"number"==typeof a?(y=a,"function"==typeof r&&(g=r,"function"==typeof u&&(b=u))):"function"==typeof a&&(g=a,"function"==typeof r&&(b=r));var j=function(t){try{g.call(t),w.call(t)}catch(e){p(e)}},A=function(t){try{b.call(t),m.call(t)}catch(e){p(e)}};$.each(i.defaultArray,function(t,e){c[t]=e});var T=((new Date).getTime(),t+"/"+e.replace(/^\//,"")),O=$.ajax({type:n.toUpperCase(),url:T,data:c,dataType:"json",timeout:y,global:!0,cache:o,complete:function(){i.count--,0===i.count?$("#twist-ajax-loader").stop().fadeTo(200,0,function(){$(this).hide()}):$("#twist-ajax-loader-count").text(i.count>1?i.count:"")},success:function(t,e,n){var o=d(n.getResponseHeader("Content-Length"));$("#twist-ajax-loader-size").text("Downloading "+o+"..."),t&&"object"==typeof t&&s(t,"status")&&t.status===!0?j(t):A(t)},error:function(t,e,n){switch(e){case"abort":A(),$("#twist-ajax-loader-size").text("Aborted"),p("The AJAX request was aborted");break;case"timeout":A(),$("#twist-ajax-loader-size").text("Timeout"),p("The AJAX request timed out");break;case"parsererror":var o=/{"status":(true|false),"message":"[^"]*","data":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*(,"debug":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*)?}/,a=d(t.getResponseHeader("Content-Length")),r="===============================================";if(p(r+"\nPARSER ERROR RECOVERY\n"+r+"\nDate:             "+t.getResponseHeader("Date")+"\nLocation:         "+T+"\nTimeout:          "+y/1e3+"s\nResponse length:  "+a+("undefined"!=typeof JSON?"\nPost data:        "+JSON.stringify(c):"{}")+"\n"+r),o.test(t.responseText)){var u=t.responseText.match(o)[0];if(null!==$.parseJSON(u)){var s=$.parseJSON(u);"object"==typeof s&&"status"in s&&s.status===!0?j(s):A(s)}else{A();try{i.onfail(n)}catch(f){p(f)}}}else{A();try{i.onfail(n)}catch(f){p(f)}}break;default:A(),$("#twist-ajax-loader-size").text("Error");try{i.onfail(n)}catch(f){p(f)}}}});return O};if("string"!=typeof t||""==t)throw new Error("Need to specify a valid AJAX post location");return t=t.replace(/\/$/,""),"function"==typeof e?(w=e,"function"==typeof n?(m=n,"object"==typeof o?(g=o,"number"==typeof a?(v=a,"string"==typeof r&&(b=r)):"string"==typeof a&&(b=a)):"number"==typeof o?(v=o,"string"==typeof a&&(b=a)):"string"==typeof o&&(b=o)):"object"===n?(g=n,"number"==typeof o?(v=o,"string"==typeof a&&(b=a)):"string"==typeof o&&(b=o)):"number"===n?(v=n,"string"==typeof o&&(b=o)):"string"==typeof n&&(b=n)):"object"==typeof e?(g=e,"number"==typeof n?(v=n,"string"==typeof o&&(b=o)):"string"==typeof n&&(b=n)):"number"==typeof e?(v=e,"string"==typeof n&&(b=n)):"string"==typeof e&&(b=e),$.ajaxSetup({url:t,timeout:v}),this.count=0,this.defaultArray=g,this["delete"]=function(t,e,n,o,a){return A(t,"DELETE",j,e,n,o,a),i},this.disableCache=function(){return j=!1,i},this.disableLoader=function(){return x=!1,i},this.enableCache=function(){return j=!0,i},this.enableLoader=function(){return x=!0,i},this.get=function(t,e,n,o,a){return A(t,"GET",j,e,n,o,a),i},this.loaderSize=function(t){return $("#twist-ajax-loader").length&&$("#twist-ajax-loader").attr("class","").addClass(t),b=t,i},this.onfail=function(t){var e="string"==typeof t&&""!==t?t:"An unexpected AJAX response was given";return p(e),i},this.patch=function(t,e,n,o,a){return A(t,"PATCH",j,e,n,o,a),i},this.post=function(t,e,n,o,a){return A(t,"POST",j,e,n,o,a),i},this.put=function(t,e,n,o,a){return A(t,"PUT",j,e,n,o,a),i},$(document).ready(function(){$("body").prepend('<div id="twist-ajax-loader" class="'+b+'"><span id="twist-ajax-loader-count"></span><span id="twist-ajax-loader-size"></span></div>')}),!0};return t}throw"Twist AJAX requires jQuery to run"}catch(e){window.console&&window.console.log&&console.log(e)}});