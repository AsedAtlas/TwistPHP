!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.twistajax=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=/^(?:submit|button|image|reset|file)$/i,n=/^(?:input|select|textarea|keygen)/i,r=/(\[[^\[\]]*\])/g;function i(e,t,n){if(t.match(r)){!function e(t,n,r){if(0===n.length)return t=r;var i=n.shift(),s=i.match(/^\[(.+?)\]$/);if("[]"===i)return t=t||[],Array.isArray(t)?t.push(e(null,n,r)):(t._values=t._values||[],t._values.push(e(null,n,r))),t;if(s){var o=s[1],u=+o;isNaN(u)?(t=t||{})[o]=e(t[o],n,r):(t=t||[])[u]=e(t[u],n,r)}else t[i]=e(t[i],n,r);return t}(e,function(e){var t=[],n=new RegExp(r),i=/^([^\[\]]*)/.exec(e);for(i[1]&&t.push(i[1]);null!==(i=n.exec(e));)t.push(i[1]);return t}(t),n)}else{var i=e[t];i?(Array.isArray(i)||(e[t]=[i]),e[t].push(n)):e[t]=n}return e}function s(e,t,n){return n=n.replace(/(\r)?\n/g,"\r\n"),n=(n=encodeURIComponent(n)).replace(/%20/g,"+"),e+(e?"&":"")+encodeURIComponent(t)+"="+n}var o=function(r,o){"object"!=(void 0===o?"undefined":e(o))?o={hash:!!o}:void 0===o.hash&&(o.hash=!0);for(var u=o.hash?{}:"",a=o.serializer||(o.hash?i:s),c=r&&r.elements?r.elements:[],d=Object.create(null),l=0;l<c.length;++l){var h=c[l];if((o.disabled||!h.disabled)&&h.name&&n.test(h.nodeName)&&!t.test(h.type)){var f=h.name,g=h.value;if("checkbox"!==h.type&&"radio"!==h.type||h.checked||(g=void 0),o.empty){if("checkbox"!==h.type||h.checked||(g=""),"radio"===h.type&&(d[h.name]||h.checked?h.checked&&(d[h.name]=!0):d[h.name]=!1),void 0==g&&"radio"==h.type)continue}else if(!g)continue;if("select-multiple"!==h.type)u=a(u,f,g);else{g=[];for(var p=h.options,b=!1,v=0;v<p.length;++v){var y=p[v],w=o.empty&&!y.value,m=y.value||w;y.selected&&m&&(b=!0,u=o.hash&&"[]"!==f.slice(f.length-2)?a(u,f+"[]",y.value):a(u,f,y.value))}!b&&o.empty&&(u=a(u,f,""))}}}if(o.empty)for(var f in d)d[f]||(u=a(u,f,""));return u},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();return function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uri=n.replace(/\/$/,""),this.cache=!1,this.requests=[],this.debug=!1,this.events={},window.twist?window.twist.ajax||(window.twist.ajax={instances:[]}):window.twist={ajax:{instances:[]}},this.on("request",function(e){window.twist.debug?window.twist.debug.logAJAX(e):t.debug&&console.info("New AJAX Request",e)}).on("response",function(e){window.twist.debug&&e.$debug?e.$debug.querySelector(".details").outerHTML="<pre>"+JSON.stringify({response:e.response},void 0,2)+"</pre>":t.debug}).on("success",function(e){window.twist.debug&&e.$debug?"twist-debug-box-"===e.$debug.getAttribute("class")&&(e.$debug.classList.remove("twist-debug-box-"),e.$debug.classList.add("twist-debug-box-green")):t.debug}).on("fail",function(e){window.twist.debug&&e.$debug?"twist-debug-box-"===e.$debug.getAttribute("class")&&(e.$debug.classList.remove("twist-debug-box-"),e.$debug.classList.add("twist-debug-box-yellow")):t.debug}).on("error",function(e){if(window.twist.debug&&e.$debug){if("twist-debug-box-"===e.$debug.getAttribute("class")){e.$debug.classList.remove("twist-debug-box-"),e.$debug.classList.add("twist-debug-box-red");var n=document.createElement("pre");n.innerHTML="Error: "+e.error;var r=e.$debug.querySelector(".details");r.parentNode.replaceChild(n,r)}}else t.debug}),window.twist.ajax.instances.push(this)}return u(e,[{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"DELETE")}},{key:"get",value:function(e){return this.send(e,{},"GET")}},{key:"head",value:function(e){return this.send(e,{},"HEAD")}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PATCH")}},{key:"post",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"POST")}},{key:"put",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PUT")}},{key:"postForm",value:function(e,t){var n=o(document.querySelector(t),{empty:!0});return this.post(e,n)}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"trigger",value:function(e,t){if(this.events[e]){var n=!0,r=!1,i=void 0;try{for(var s,o=this.events[e][Symbol.iterator]();!(n=(s=o.next()).done);n=!0){s.value.call(this,t)}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}return this}},{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",i={method:r,headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"},cache:this.cache?"default":"no-store"};"GET"!==r&&(i.body=JSON.stringify(n));var s={url:this.uri+"/"+e,options:i};return s.instance=new Promise(function(n,r){fetch(t.uri+"/"+e,i).then(function(e){if(e.ok)return e.text().then(function(e){try{return JSON.parse(e)}catch(r){var t='("status" ?: ?(true|false)?|"message" ?: ?".*"|"data" ?: ?(\\{.*\\}|\\[.*\\]))',n=new RegExp("{("+t+" ?, ?){2}"+t+"}","g").exec(e);if(null!==n)return console.warn("Broken AJAX response parsed"),JSON.parse(n[0]);throw e}}).catch(function(e){throw e});throw e.status+" "+e.statusText}).then(function(e){if(s.response=e,t.trigger("response",s),!0!==e.status)throw t.trigger("fail",s),e.message||"AJAX status returned FALSE";return t.trigger("success",s),n(e.data),e}).catch(function(e){s.error=e,t.trigger("error",s),r(e)})}),this.requests.push(s),this.trigger("request",s),s.instance}}]),e}()});
//# sourceMappingURL=twistajax.js.map
