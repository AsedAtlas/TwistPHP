var twistajax=function(){"use strict";function e(e){var t=[],n=/^([^\[\]]*)/,r=new RegExp(a),s=n.exec(e);for(s[1]&&t.push(s[1]);null!==(s=r.exec(e));)t.push(s[1]);return t}function t(e,n,r){if(0===n.length)return e=r;var s=n.shift(),i=s.match(/^\[(.+?)\]$/);if("[]"===s)return e=e||[],Array.isArray(e)?e.push(t(null,n,r)):(e._values=e._values||[],e._values.push(t(null,n,r))),e;if(i){var o=i[1],u=+o;isNaN(u)?(e=e||{})[o]=t(e[o],n,r):(e=e||[])[u]=t(e[u],n,r)}else e[s]=t(e[s],n,r);return e}function n(n,r,s){if(r.match(a))t(n,e(r),s);else{var i=n[r];i?(Array.isArray(i)||(n[r]=[i]),n[r].push(s)):n[r]=s}return n}function r(e,t,n){return n=n.replace(/(\r)?\n/g,"\r\n"),n=encodeURIComponent(n),n=n.replace(/%20/g,"+"),e+(e?"&":"")+encodeURIComponent(t)+"="+n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=/^(?:submit|button|image|reset|file)$/i,u=/^(?:input|select|textarea|keygen)/i,a=/(\[[^\[\]]*\])/g,c=function(e,t){"object"!=(void 0===t?"undefined":i(t))?t={hash:!!t}:void 0===t.hash&&(t.hash=!0);for(var s=t.hash?{}:"",a=t.serializer||(t.hash?n:r),c=e&&e.elements?e.elements:[],l=Object.create(null),d=0;d<c.length;++d){var h=c[d];if((t.disabled||!h.disabled)&&h.name&&u.test(h.nodeName)&&!o.test(h.type)){var f=h.name,g=h.value;if("checkbox"!==h.type&&"radio"!==h.type||h.checked||(g=void 0),t.empty){if("checkbox"!==h.type||h.checked||(g=""),"radio"===h.type&&(l[h.name]||h.checked?h.checked&&(l[h.name]=!0):l[h.name]=!1),void 0==g&&"radio"==h.type)continue}else if(!g)continue;if("select-multiple"!==h.type)s=a(s,f,g);else{g=[];for(var p=h.options,v=!1,b=0;b<p.length;++b){var w=p[b],y=t.empty&&!w.value,m=w.value||y;w.selected&&m&&(v=!0,s=t.hash&&"[]"!==f.slice(f.length-2)?a(s,f+"[]",w.value):a(s,f,w.value))}!v&&t.empty&&(s=a(s,f,""))}}}if(t.empty)for(var f in l)l[f]||(s=a(s,f,""));return s},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();return function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";s(this,e),this.uri=n.replace(/\/$/,""),this.cache=!1,this.requests=[],this.debug=!1,this.events={},window.twist?window.twist.ajax||(window.twist.ajax={instances:[]}):window.twist={ajax:{instances:[]}},this.on("response",function(e){window.twist.debug&&e.$debug?e.$debug.find(".details").replaceWith("<pre>"+JSON.stringify({response:e.response},void 0,2)+"</pre>"):t.debug}).on("success",function(e){window.twist.debug&&e.$debug?"twist-debug-box-"===e.$debug.attr("class")&&e.$debug.removeClass("twist-debug-box-").addClass("twist-debug-box-green"):t.debug}).on("fail",function(e){window.twist.debug&&e.$debug?"twist-debug-box-"===e.$debug.attr("class")&&e.$debug.removeClass("twist-debug-box-").addClass("twist-debug-box-yellow"):t.debug}).on("error",function(e){window.twist.debug&&e.$debug?"twist-debug-box-"===e.$debug.attr("class")&&e.$debug.removeClass("twist-debug-box-").addClass("twist-debug-box-red").find(".details").replaceWith("<p>Error: "+e.error+"</p>"):t.debug}),window.twist.ajax.instances.push(this)}return l(e,[{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"DELETE")}},{key:"get",value:function(e){return this.send(e,{},"GET")}},{key:"head",value:function(e){return this.send(e,{},"HEAD")}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PATCH")}},{key:"post",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"POST")}},{key:"put",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PUT")}},{key:"postForm",value:function(e,t){var n=c(document.querySelector(t),{empty:!0});return this.post(e,n)}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"trigger",value:function(e,t){if(this.events[e]){var n=!0,r=!1,s=void 0;try{for(var i,o=this.events[e][Symbol.iterator]();!(n=(i=o.next()).done);n=!0)i.value.call(this,t)}catch(e){r=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}}return this}},{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",s={method:r,headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json; charset=utf-8","X-Requested-With":"XMLHttpRequest"},cache:this.cache?"default":"no-store"};"GET"!==r&&(s.body=JSON.stringify(n));var i={url:this.uri+"/"+e,options:s};return i.instance=new Promise(function(n,r){fetch(t.uri+"/"+e,s).then(function(e){if(e.ok)return e.text().then(function(e){try{return JSON.parse(e)}catch(r){var t='("status" ?: ?(true|false)?|"message" ?: ?".*"|"data" ?: ?(\\{.*\\}|\\[.*\\]))',n=new RegExp("{("+t+" ?, ?){2}"+t+"}","g").exec(e);if(null!==n)return console.warn("Broken AJAX response parsed"),JSON.parse(n[0]);throw e}}).catch(function(e){throw e});throw console.log(e),e.status+" "+e.statusText}).then(function(e){if(i.response=e,t.trigger("response",i),!0!==e.status)throw t.trigger("fail",i),e.message||"AJAX status returned FALSE";return t.trigger("success",i),n(e.data),e}).catch(function(e){i.error=e,t.trigger("error",i),r(e)})}),this.trigger("request",i),window.twist.debug?window.twist.debug.logAJAX(i):this.debug&&console.info("New AJAX Request",i),this.requests.push(i),i.instance}}]),e}()}();
//# sourceMappingURL=twistajax.js.map
