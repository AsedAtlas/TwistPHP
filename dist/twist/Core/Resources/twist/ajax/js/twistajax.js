"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_formSerialize=require("../../../../../node_modules/form-serialize"),twistajax=function(){function e(t){_classCallCheck(this,e),this.URI=t,this.globalSuccessFunction=function(){},this.globalFailureFunction=function(){},this.timeout=1e4,this.cache=!1,this.requests=0,this.debug=!1,this.loader=null}return _createClass(e,[{key:"get",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this.send("GET",e)}},{key:"post",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this.send("POST",e)}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"GET";return new Promise(function(e,r){fetch(n.URI,{method:a,headers:myHeaders,cache:n.cache?"default":"no-store"}).then(function(e){return e.json()}).then(function(e){return e}).then(function(e){t.apply(e)}).then(function(t){return e(t)})["catch"](function(e){o.apply(),r(e)})})}}],[{key:"serializeJSON",value:function(e){var t=this,n={},o=[];jQuery.map(e.serializeArray(),function(e,t){o.push({name:e.name,value:e.value})}),e.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var e=$(t);o.push({name:e.attr("name"),value:e.val()})});var a=function r(e,t,n,a){var i={},u=n.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(u){var f=u[2];if(isBlank(f)){var s=1,c=!0;do{var l=!0;for(var d in o)contains(t+"["+s+"]",o[d].name)&&(s++,l=!1);if(l){var p=!1;for(var y in o)p||o[y].name!==t+"[]"||o[y].value!==a||(o[y].name=t+"["+s+"]",p=!0);c=!1}}while(c);f=s}u[3]?i[f]=r(e,t+"["+f+"]",u[3],a):i[f]=a}return i};return $.each(o,function(e,t){var o=t.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(o){var r={};r[o[1]]=a(t.name,o[1],o[2],t.value),n=$.extend(!0,n,r)}else n[t.name]=t.value}),n}}]),e}();exports["default"]=twistajax,function(e,t){"function"==typeof define&&define.amd?define("twistajax",["jquery"],function(n){return e.twistajax=t(n)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t(require("jQuery")):e.twistajax=t(e.jQuery)}(void 0,function(e){try{if(e){/**
    * Create a new instance of the TwistAJAX object
    * @param strAJAXPostLocation
    * @param {?(function|Object|number|string)} b B
    * @param {?function} b Master callback success function
    * @param {?Object} b Default data
    * @param {?number} b Default timeout
    * @param {?string} b Loader size
    * @param {?function} c Master callback failure function
    * @param {?Object} c Default data
    * @param {?number} c Default timeout
    * @param {?string} c Loader size
    * @param {?Object} d Default data
    * @param {?number} d Default timeout
    * @param {?string} d Loader size
    * @param {?number} e Default timeout
    * @param {?string} e Loader size
    * @param {?string} f Loader size
    * @returns {boolean}
    * @alias twistajax
    * @constructor
    * @author Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>
    * @version 1.0.0
    * @license GPL-3.0
    */
var t=function(t,n,o,a,r,i){var u=this,f=!1,s=function(e,t,n){return n="boolean"==typeof n&&n,n?t.indexOf(e)!==-1:t.toLowerCase().indexOf(e.toLowerCase())!==-1},c=function(e,t){return d()&&Object.prototype.hasOwnProperty.call(e,t)||e.hasOwnProperty(t)},l=function(e){return""===e.replace(/[\s\t\r\n]*/g,"")},d=function(){return navigator.userAgent.indexOf("MSIE ")},p=function(){f&&y(arguments)},y=function(){var e=arguments;if(window.twistdebug&&e.length>0)for(var t in e)window.twistdebug.error(e[t]);else if(window.console&&window.console.log&&e.length>0)for(var n in e)window.console.log(e[n])},h=function(e){var t=0;if("object"===("undefined"==typeof e?"undefined":_typeof(e)))for(var n in e)c(e,n)&&t++;return t},v=function(e,t){for(var n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],o=0;n[o]&&e>Math.pow(1024,o+1);)o++;return w(e/Math.pow(1024,o),2)+("boolean"==typeof t&&t?" ":"")+n[o]},w=function(e,t){return t="number"!=typeof t?0:t,0===t?parseInt(Math.round(e*Math.pow(10,t))/Math.pow(10,t)):parseFloat(Math.round(e*Math.pow(10,t))/Math.pow(10,t))},m=function(t){var n={},o=[];e.map(t.serializeArray(),function(e,t){o.push({name:e.name,value:e.value})}),t.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var e=$(this);o.push({name:e.attr("name"),value:e.val()})});var a=function r(e,t,n,a){var i={},u=n.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(u){var f=u[2];if(l(f)){var c=1,d=!0;do{var p=!0;for(var y in o)s(t+"["+c+"]",o[y].name)&&(c++,p=!1);if(p){var h=!1;for(var v in o)h||o[v].name!==t+"[]"||o[v].value!==a||(o[v].name=t+"["+c+"]",h=!0);d=!1}}while(d);f=c}u[3]?i[f]=r(e,t+"["+f+"]",u[3],a):i[f]=a}return i};return $.each(o,function(e,t){var o=t.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(o){var r={};r[o[1]]=a(t.name,o[1],o[2],t.value),n=$.extend(!0,n,r)}else n[t.name]=t.value}),n},b=function(){},g=function(){},j={},x=1e4,A="medium",R=!1,O=!0,S=function(n,o,a,r,i,f,s){u.count++,o="string"==typeof o?o:"POST",$("#twist-ajax-loader-size").text("Loading..."),u.count>1&&$("#twist-ajax-loader-count").text(u.count),O&&$("#twist-ajax-loader").stop().show().fadeTo(0,1);var l={},d=x,w=function(){},j=function(){};"object"===("undefined"==typeof r?"undefined":_typeof(r))||"string"==typeof r&&/^\#[0-9a-z_\-]+$/i.test(r)&&($(r)instanceof e||r.jquery)?(l="object"===("undefined"==typeof r?"undefined":_typeof(r))?r instanceof e||r.jquery?m(r):0===h(r)?l:r:m($(r)),"number"==typeof i?(d=i,"function"==typeof f&&(w=f,"function"==typeof s&&(j=s))):"function"==typeof i&&(w=i,"function"==typeof f&&(j=f))):"number"==typeof r?(d=r,"function"==typeof i&&(w=i,"function"==typeof f&&(j=f))):"function"==typeof r&&(w=r,"function"==typeof i&&(j=i));var A=t+"/"+n.replace(/^\//,""),R={type:o.toUpperCase(),url:A,data:l,dataType:"json",timeout:d,global:!0,cache:a,complete:function(e,t){u.count--,0===u.count?$("#twist-ajax-loader").stop().fadeTo(200,0,function(){$(this).hide()}):$("#twist-ajax-loader-count").text(u.count>1?u.count:"")},success:function(e,t,n){var o=v(n.getResponseHeader("Content-Length"));$("#twist-ajax-loader-size").text("Downloading "+o+"..."),e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&c(e,"status")&&e.status===!0?S(e,R):T(e,R)},error:function(e,t,n){switch(t){case"abort":T({},R),$("#twist-ajax-loader-size").text("Aborted"),p("The AJAX request was aborted");break;case"timeout":T({},R),$("#twist-ajax-loader-size").text("Timeout"),p("The AJAX request timed out");break;case"parsererror":var o=/{"status":(true|false),"message":"[^"]*","data":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*(,"debug":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*)?}/,a=v(e.getResponseHeader("Content-Length")),r="===============================================";if(o.test(e.responseText)){y(window.twistdebug?r+"<br>PARSER ERROR RECOVERY<br>"+r+"<br>Date:             "+e.getResponseHeader("Date")+"<br>Location:         "+A+"<br>Timeout:          "+d/1e3+"s<br>Response length:  "+a+("undefined"!=typeof JSON?"<br>Post data:        "+JSON.stringify(l):"{}")+"<br>"+r:r+"\nPARSER ERROR RECOVERY\n"+r+"\nDate:             "+e.getResponseHeader("Date")+"\nLocation:         "+A+"\nTimeout:          "+d/1e3+"s\nResponse length:  "+a+("undefined"!=typeof JSON?"\nPost data:        "+JSON.stringify(l):"{}")+"\n"+r);var i=e.responseText.match(o)[0];if(null!==$.parseJSON(i)){var f=$.parseJSON(i);"object"===("undefined"==typeof f?"undefined":_typeof(f))&&"status"in f&&f.status===!0?S(f,R):T(f,R)}else{T({},R);try{u.onfail(n)}catch(s){p(s)}}}else{y("Parse error"),T({},R);try{u.onfail(n)}catch(s){p(s)}}break;default:T({},R),$("#twist-ajax-loader-size").text("Error");try{u.onfail(n)}catch(s){p(s)}}}},S=function(e,t){try{w.call(e,t),b.call(e,t),window.twistdebug&&window.twistdebug.logAJAX(!0,e,t)}catch(n){p(n)}},T=function(e,t){try{j.call(e,t),g.call(e,t),window.twistdebug&&window.twistdebug.logAJAX(!1,e,t)}catch(n){p(n)}};return $.each(u.defaultArray,function(e,t){l[e]=t}),R.data=l,$.ajax(R)};if("string"!=typeof t||""===t)throw new Error("Please specify an AJAX URI");return t=t.replace(/\/$/,""),"function"==typeof n?(b=n,"function"==typeof o?(g=o,"object"===("undefined"==typeof a?"undefined":_typeof(a))?(j=a,"number"==typeof r?(x=r,"string"==typeof i&&(A=i)):"string"==typeof r&&(A=r)):"number"==typeof a?(x=a,"string"==typeof r&&(A=r)):"string"==typeof a&&(A=a)):"object"===("undefined"==typeof o?"undefined":_typeof(o))?(j=o,"number"==typeof a?(x=a,"string"==typeof r&&(A=r)):"string"==typeof a&&(A=a)):"number"==typeof o?(x=o,"string"==typeof a&&(A=a)):"string"==typeof o&&(A=o)):"object"===("undefined"==typeof n?"undefined":_typeof(n))?(j=n,"number"==typeof o?(x=o,"string"==typeof a&&(A=a)):"string"==typeof o&&(A=o)):"number"==typeof n?(x=n,"string"==typeof o&&(A=o)):"string"==typeof n&&(A=n),$.ajaxSetup({url:t,timeout:x}),this.count=0,this.debug=function(e){return f=e!==!1,u},this.defaultArray=j,this["delete"]=function(e,t,n,o,a){return e&&S(e,"DELETE",R,t,n,o,a),u},this.disableCache=function(){return R=!1,u},this.disableLoader=function(){return O=!1,u},this.enableCache=function(){return R=!0,u},this.enableLoader=function(){return O=!0,u},this.get=function(e,t,n,o,a){return e&&S(e,"GET",R,t,n,o,a),u},this.loaderSize=function(e){return $("#twist-ajax-loader").length&&$("#twist-ajax-loader").attr("class","").addClass(e),A=e,u},this.onfail=function(e){var t="string"==typeof e&&""!==e?e:"An unexpected AJAX response was given";return p(t),u},this.patch=function(e,t,n,o,a){return S(e,"PATCH",R,t,n,o,a),u},this.post=function(e,t,n,o,a){return e&&S(e,"POST",R,t,n,o,a),u},this.put=function(e,t,n,o,a){return e&&S(e,"PUT",R,t,n,o,a),u},$(document).ready(function(){$("#twist-ajax-loader").length||$("body").prepend('<div id="twist-ajax-loader" class="'+A+'"><span id="twist-ajax-loader-count"></span><span id="twist-ajax-loader-size"></span></div>')}),!0};return t}throw"Twist AJAX requires jQuery to run"}catch(n){window.twistdebug?window.twistdebug.error(n):window.console&&window.console.log&&console.error(n)}});