var twistajax=function(){"use strict";function e(e){var t=[],n=/^([^\[\]]*)/,r=new RegExp(u),o=n.exec(e);for(o[1]&&t.push(o[1]);null!==(o=r.exec(e));)t.push(o[1]);return t}function t(e,n,r){if(0===n.length)return e=r;var o=n.shift(),i=o.match(/^\[(.+?)\]$/);if("[]"===o)return e=e||[],Array.isArray(e)?e.push(t(null,n,r)):(e._values=e._values||[],e._values.push(t(null,n,r))),e;if(i){var a=i[1],s=+a;isNaN(s)?(e=e||{})[a]=t(e[a],n,r):(e=e||[])[s]=t(e[s],n,r)}else e[o]=t(e[o],n,r);return e}function n(n,r,o){if(r.match(u))t(n,e(r),o);else{var i=n[r];i?(Array.isArray(i)||(n[r]=[i]),n[r].push(o)):n[r]=o}return n}function r(e,t,n){return n=n.replace(/(\r)?\n/g,"\r\n"),n=encodeURIComponent(n),n=n.replace(/%20/g,"+"),e+(e?"&":"")+encodeURIComponent(t)+"="+n}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=/^(?:submit|button|image|reset|file)$/i,s=/^(?:input|select|textarea|keygen)/i,u=/(\[[^\[\]]*\])/g,c=function(e,t){"object"!=(void 0===t?"undefined":i(t))?t={hash:!!t}:void 0===t.hash&&(t.hash=!0);for(var o=t.hash?{}:"",u=t.serializer||(t.hash?n:r),c=e&&e.elements?e.elements:[],l=Object.create(null),h=0;h<c.length;++h){var f=c[h];if((t.disabled||!f.disabled)&&f.name&&s.test(f.nodeName)&&!a.test(f.type)){var p=f.name,v=f.value;if("checkbox"!==f.type&&"radio"!==f.type||f.checked||(v=void 0),t.empty){if("checkbox"!==f.type||f.checked||(v=""),"radio"===f.type&&(l[f.name]||f.checked?f.checked&&(l[f.name]=!0):l[f.name]=!1),void 0==v&&"radio"==f.type)continue}else if(!v)continue;if("select-multiple"!==f.type)o=u(o,p,v);else{v=[];for(var d=f.options,y=!1,g=0;g<d.length;++g){var m=d[g],w=t.empty&&!m.value,b=m.value||w;m.selected&&b&&(y=!0,o=t.hash&&"[]"!==p.slice(p.length-2)?u(o,p+"[]",m.value):u(o,p,m.value))}!y&&t.empty&&(o=u(o,p,""))}}}if(t.empty)for(var p in l)l[p]||(o=u(o,p,""));return o},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";o(this,e),this.uri=t.replace(/\/$/,""),this.cache=!1,this.requests=[],this.debug=!1,this.events={},window.twist?window.twist.ajax||(window.twist.ajax={instances:[]}):window.twist={ajax:{instances:[]}},window.twist.ajax.instances.push(this)}return l(e,[{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"DELETE")}},{key:"get",value:function(e){return this.send(e,{},"GET")}},{key:"head",value:function(e){return this.send(e,{},"HEAD")}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PATCH")}},{key:"post",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"POST")}},{key:"put",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.send(e,t,"PUT")}},{key:"postForm",value:function(e,t){var n=c(document.querySelector(t),{empty:!0});return this.post(e,n)}},{key:"on",value:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}},{key:"trigger",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.events[e][Symbol.iterator]();!(t=(o=i.next()).done);t=!0)o.value.call(this)}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}},{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",o=new Promise(function(o,i){t.trigger("request");var a={method:r,headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json; charset=utf-8"},cache:t.cache?"default":"no-store"};"GET"!==r&&(a.body=JSON.stringify(n)),fetch(t.uri+"/"+e,a).then(function(e){return e.text().then(function(e){try{return JSON.parse(e)}catch(r){var t='("status" ?: ?(true|false)?|"message" ?: ?".*"|"data" ?: ?(\\{.*\\}|\\[.*\\]))',n=new RegExp("{("+t+" ?, ?){2}"+t+"}","g").exec(e);if(null!==n)return console.warn("Broken AJAX response parsed"),JSON.parse(n[0]);throw e}}).catch(function(e){throw e})}).then(function(e){if(t.trigger("response"),!0!==e.status)throw e.message||"AJAX status returned FALSE";return e.data}).then(function(e){return o(e)}).catch(function(e){i(e)})});return this.requests.push(o),o}},{key:"debug",set:function(e){if(e)try{var t=["%c %c %c TwistPHP AJAX %c %c ","font-size: 15px; background: #2a5200;","font-size: 17px; background: #3f7a00;","color: #FFF; font-size: 18px; background: #539F00;","font-size: 17px; background: #3f7a00;","font-size: 15px; background: #2a5200;"];console.log.apply(console,t)}catch(e){console.info?console.info("TwistPHP AJAX"):console.log("TwistPHP AJAX")}}}]),e}()}();
//# sourceMappingURL=twistajax.js.map
