/*!
 * This file is part of TwistPHP.
 *
 * TwistPHP is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TwistPHP is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with TwistPHP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>
 * @license    https://www.gnu.org/licenses/gpl.html LGPL License
 * @link       https://twistphp.com
 *
 * --------------
 * TwistPHP AJAX
 * --------------
 */
!function(t,e){"function"==typeof define&&define.amd?define("twistajax",["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("twistajax")):t.returnExports=e(t.jQuery,t.twistajax)}(this,function(t,e){try{if(t){var n=function(e,n,o,a,r,i){var s=this,u=!1,f=function(t,e,n){return n="boolean"==typeof n?n:!1,n?-1!==e.indexOf(t):-1!==e.toLowerCase().indexOf(t.toLowerCase())},c=function(t,e){return d()&&Object.prototype.hasOwnProperty.call(t,e)||t.hasOwnProperty(e)},p=function(t){return""===t.replace(/[\s\t\r\n]*/g,"")},d=function(){return navigator.userAgent.indexOf("MSIE ")},l=function(){u&&w(arguments)},w=function(){var t=arguments;if(window.twistdebug&&t.length>0)for(var e in t)window.twistdebug.error(t[e]);else if(window.console&&window.console.log&&t.length>0)for(var n in t)window.console.log(t[n])},y=function(t){var e=0;if("object"==typeof t)for(var n in t)c(t,n)&&e++;return e},h=function(t,e){for(var n=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],o=0;n[o]&&t>Math.pow(1024,o+1);)o++;return g(t/Math.pow(1024,o),2)+("boolean"==typeof e&&e?" ":"")+n[o]},g=function(t,e){return e="number"!=typeof e?0:e,0===e?parseInt(Math.round(t*Math.pow(10,e))/Math.pow(10,e)):parseFloat(Math.round(t*Math.pow(10,e))/Math.pow(10,e))},b=function(e){var n={},o=[];t.map(e.serializeArray(),function(t,e){o.push({name:t.name,value:t.value})}),e.find('input[type="submit"][name][value], input[type="reset"][name][value], input[type="button"][name][value], button[name][value]').each(function(){var t=$(this);o.push({name:t.attr("name"),value:t.val()})});var a=function(t,e,n,r){var i={},s=n.match(/^(\[([^\[]*)\])((\[[^\[]*\])*)$/i);if(s){var u=s[2];if(p(u)){var c=1,d=!0;do{var l=!0;for(var w in o)f(e+"["+c+"]",o[w].name)&&(c++,l=!1);if(l){var y=!1;for(var h in o)y||o[h].name!==e+"[]"||o[h].value!==r||(o[h].name=e+"["+c+"]",y=!0);d=!1}}while(d);u=c}s[3]?i[u]=a(t,e+"["+u+"]",s[3],r):i[u]=r}return i};return $.each(o,function(t,e){var o=e.name.match(/^([^\[]+)((\[[^\[]*\])+)$/i);if(o){var r={};r[o[1]]=a(e.name,o[1],o[2],e.value),n=$.extend(!0,n,r)}else n[e.name]=e.value}),n},m=function(){},v=function(){},x={},j=1e4,A="medium",R=!1,O=!0,T=function(n,o,a,r,i,u,f){s.count++,o="string"==typeof o?o:"POST",$("#twist-ajax-loader-size").text("Loading..."),s.count>1&&$("#twist-ajax-loader-count").text(s.count),O&&$("#twist-ajax-loader").stop().show().fadeTo(0,1);var p={},d=j,g=function(){},x=function(){};"object"==typeof r||"string"==typeof r&&/^\#[0-9a-z_\-]+$/i.test(r)&&($(r)instanceof t||r.jquery)?(p="object"==typeof r?r instanceof t||r.jquery?b(r):0===y(r)?p:r:b($(r)),"number"==typeof i?(d=i,"function"==typeof u&&(g=u,"function"==typeof f&&(x=f))):"function"==typeof i&&(g=i,"function"==typeof u&&(x=u))):"number"==typeof r?(d=r,"function"==typeof i&&(g=i,"function"==typeof u&&(x=u))):"function"==typeof r&&(g=r,"function"==typeof i&&(x=i));var A=e+"/"+n.replace(/^\//,""),R={type:o.toUpperCase(),url:A,data:p,dataType:"json",timeout:d,global:!0,cache:a,complete:function(t,e){s.count--,0===s.count?$("#twist-ajax-loader").stop().fadeTo(200,0,function(){$(this).hide()}):$("#twist-ajax-loader-count").text(s.count>1?s.count:"")},success:function(t,e,n){var o=h(n.getResponseHeader("Content-Length"));$("#twist-ajax-loader-size").text("Downloading "+o+"..."),t&&"object"==typeof t&&c(t,"status")&&t.status===!0?T(t,R):E(t,R)},error:function(t,e,n){switch(e){case"abort":E({},R),$("#twist-ajax-loader-size").text("Aborted"),l("The AJAX request was aborted");break;case"timeout":E({},R),$("#twist-ajax-loader-size").text("Timeout"),l("The AJAX request timed out");break;case"parsererror":var o=/{"status":(true|false),"message":"[^"]*","data":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*(,"debug":({.*}|\[\])(,"[^"]+":(true|false|("[^"]*")|({.*}|\[\])))*)?}/,a=h(t.getResponseHeader("Content-Length")),r="===============================================";if(o.test(t.responseText)){w(window.twistdebug?r+"<br>PARSER ERROR RECOVERY<br>"+r+"<br>Date:             "+t.getResponseHeader("Date")+"<br>Location:         "+A+"<br>Timeout:          "+d/1e3+"s<br>Response length:  "+a+("undefined"!=typeof JSON?"<br>Post data:        "+JSON.stringify(p):"{}")+"<br>"+r:r+"\nPARSER ERROR RECOVERY\n"+r+"\nDate:             "+t.getResponseHeader("Date")+"\nLocation:         "+A+"\nTimeout:          "+d/1e3+"s\nResponse length:  "+a+("undefined"!=typeof JSON?"\nPost data:        "+JSON.stringify(p):"{}")+"\n"+r);var i=t.responseText.match(o)[0];if(null!==$.parseJSON(i)){var u=$.parseJSON(i);"object"==typeof u&&"status"in u&&u.status===!0?T(u,R):E(u,R)}else{E({},R);try{s.onfail(n)}catch(f){l(f)}}}else{w("Parse error"),E({},R);try{s.onfail(n)}catch(f){l(f)}}break;default:E({},R),$("#twist-ajax-loader-size").text("Error");try{s.onfail(n)}catch(f){l(f)}}}},T=function(t,e){try{g.call(t,e),m.call(t,e),window.twistdebug&&window.twistdebug.logAJAX(!0,t,e)}catch(n){l(n)}},E=function(t,e){try{x.call(t,e),v.call(t,e),window.twistdebug&&window.twistdebug.logAJAX(!1,t,e)}catch(n){l(n)}};return $.each(s.defaultArray,function(t,e){p[t]=e}),R.data=p,$.ajax(R)};if("string"!=typeof e||""===e)throw new Error("Please specify an AJAX URI");return e=e.replace(/\/$/,""),"function"==typeof n?(m=n,"function"==typeof o?(v=o,"object"==typeof a?(x=a,"number"==typeof r?(j=r,"string"==typeof i&&(A=i)):"string"==typeof r&&(A=r)):"number"==typeof a?(j=a,"string"==typeof r&&(A=r)):"string"==typeof a&&(A=a)):"object"===o?(x=o,"number"==typeof a?(j=a,"string"==typeof r&&(A=r)):"string"==typeof a&&(A=a)):"number"===o?(j=o,"string"==typeof a&&(A=a)):"string"==typeof o&&(A=o)):"object"==typeof n?(x=n,"number"==typeof o?(j=o,"string"==typeof a&&(A=a)):"string"==typeof o&&(A=o)):"number"==typeof n?(j=n,"string"==typeof o&&(A=o)):"string"==typeof n&&(A=n),$.ajaxSetup({url:e,timeout:j}),this.count=0,this.debug=function(t){return u=t!==!1,s},this.defaultArray=x,this["delete"]=function(t,e,n,o,a){return t&&T(t,"DELETE",R,e,n,o,a),s},this.disableCache=function(){return R=!1,s},this.disableLoader=function(){return O=!1,s},this.enableCache=function(){return R=!0,s},this.enableLoader=function(){return O=!0,s},this.get=function(t,e,n,o,a){return t&&T(t,"GET",R,e,n,o,a),s},this.loaderSize=function(t){return $("#twist-ajax-loader").length&&$("#twist-ajax-loader").attr("class","").addClass(t),A=t,s},this.onfail=function(t){var e="string"==typeof t&&""!==t?t:"An unexpected AJAX response was given";return l(e),s},this.patch=function(t,e,n,o,a){return T(t,"PATCH",R,e,n,o,a),s},this.post=function(t,e,n,o,a){return t&&T(t,"POST",R,e,n,o,a),s},this.put=function(t,e,n,o,a){return t&&T(t,"PUT",R,e,n,o,a),s},$(document).ready(function(){$("#twist-ajax-loader").length||$("body").prepend('<div id="twist-ajax-loader" class="'+A+'"><span id="twist-ajax-loader-count"></span><span id="twist-ajax-loader-size"></span></div>')}),!0};return n}throw"Twist AJAX requires jQuery to run"}catch(o){window.twistdebug?window.twistdebug.error(o):window.console&&window.console.log&&console.error(o)}});