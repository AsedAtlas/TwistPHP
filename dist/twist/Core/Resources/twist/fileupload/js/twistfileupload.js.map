{"version":3,"file":"twistfileupload.js","sources":["../../../../../../../src/fileupload/js/twistfileupload.js"],"sourcesContent":["/*!\n * TwistPHP - An open source PHP MVC framework built from the ground up.\n * Shadow Technologies Ltd.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>\n * @license    https://www.gnu.org/licenses/gpl.html GPL License\n * @link       https://twistphp.com\n */\n\nclass Element {\n\tconstructor( el ) {\n\t\tthis.el = el;\n\t\treturn this;\n\t}\n\n\tstatic create( tag, classes = [], attributes = {}, html = '' ) {\n\t\tconst el = document.createElement( tag );\n\n\t\tif( classes ) {\n\t\t\ttry {\n\t\t\t\tel.className = classes.join( ' ' );\n\t\t\t} catch( e ) {\n\t\t\t\tif( typeof classes === 'string' ) {\n\t\t\t\t\tel.className = classes;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif( attributes ) {\n\t\t\tfor( let attribute in attributes ) {\n\t\t\t\tif( attributes.hasOwnProperty( attribute ) ) {\n\t\t\t\t\tel.setAttribute( attribute, attributes[attribute] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif( html ) {\n\t\t\tel.innerHTML = html;\n\t\t}\n\n\t\treturn el;\n\t}\n\n\tshow() {\n\t\tthis.toggle( true );\n\t}\n\n\thide() {\n\t\tthis.toggle();\n\t}\n\n\ttoggle( show ) {\n\t\tlet value = this.el.getAttribute( 'data-initialdisplay' ),\n\t\t\t\tdisplay = this.el.style.display,\n\t\t\t\tcomputedDisplay = (window.getComputedStyle ? getComputedStyle( this.el, null ) : this.el.currentStyle).display;\n\n\t\tif( show ) {\n\t\t\tif( !value &&\n\t\t\t\t\tdisplay === 'none' ) {\n\t\t\t\tthis.el.style.display = '';\n\t\t\t}\n\t\t\tif( this.el.style.display === '' &&\n\t\t\t\t\tcomputedDisplay === 'none' ) {\n\t\t\t\tvalue = value || defaultDisplay( this.el.nodeName );\n\t\t\t}\n\t\t} else {\n\t\t\tif( display &&\n\t\t\t\t\tdisplay !== 'none'\n\t\t\t\t\t|| !(computedDisplay === 'none') ) {\n\t\t\t\tthis.el.setAttribute( 'data-initialdisplay', (computedDisplay === 'none') ? display : computedDisplay );\n\t\t\t}\n\t\t}\n\n\t\tif( !show ||\n\t\t\t\tthis.el.style.display === 'none' ||\n\t\t\t\tthis.el.style.display === '' ) {\n\t\t\tthis.el.style.display = show ? value || '' : 'none';\n\t\t}\n\t}\n}\n\nexport default class twistfileupload {\n\tconstructor( id, uri, name, settings = {} ) {\n\t\tlet uploadSupported = ( typeof new XMLHttpRequest().responseType === 'string' && 'withCredentials' in new XMLHttpRequest() );\n\n\t\tif( uploadSupported ) {\n\t\t\tlet requestTest = new XMLHttpRequest();\n\t\t\trequestTest.open( 'GET', '/' );\n\t\t\ttry {\n\t\t\t\trequestTest.responseType = 'arraybuffer';\n\t\t\t} catch( e ) {\n\t\t\t\tuploadSupported = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.settings = Object.assign( {\n\t\t\tabortable: true,\n\t\t\tacceptTypes: [],\n\t\t\tacceptExtensions: [],\n\t\t\tcounter: true,\n\t\t\tdebug: false,\n\t\t\tdragdrop: null,\n\t\t\tdragdrophoverclass: 'twistupload-drop-hover',\n\t\t\tinvalidtypemessage: 'This file type is not permitted',\n\t\t\tmultiple: false,\n\t\t\tonabort: () => {},\n\t\t\tonclear: () => {},\n\t\t\toncompletefile: () => {},\n\t\t\toncompletequeue: () => {},\n\t\t\tonerror: () => {},\n\t\t\toninvalidtype: () => {},\n\t\t\tonprogress: () => {},\n\t\t\tonstart: () => {},\n\t\t\tpreviewsize: 128,\n\t\t\tpreviewsquare: true\n\t\t}, settings );\n\n\t\tthis.id = id;\n\t\tthis.elements = {\n\t\t\t// The cancel upload button\n\t\t\tCancelUpload: Element.create( 'button', '', {}, 'Cancel' ),\n\n\t\t\t// The upload count element\n\t\t\tCount: Element.create( 'span' ),\n\n\t\t\t// The total file count element\n\t\t\tCountTotal: Element.create( 'span' ),\n\n\t\t\t// The upload count wrapper element\n\t\t\tCountWrapper: Element.create( 'span' ),\n\n\t\t\t// The file input element\n\t\t\tInput: Element.create( 'input', '', (() => {\n\t\t\t\tlet attributes = {\n\t\t\t\t\ttype: 'file',\n\t\t\t\t\t//name: multiple ? name + '[]' : name,\n\t\t\t\t\taccept: this.settings.acceptTypes.concat( this.settings.acceptExtensions ).join( ',' )\n\t\t\t\t};\n\t\t\t\tif( this.settings.multiple ) {\n\t\t\t\t\tattributes.multiple = 'multiple';\n\t\t\t\t}\n\t\t\t\treturn attributes;\n\t\t\t})() ),\n\n\t\t\t// The list of uploaded files element\n\t\t\tList: Element.create( 'ul' ),\n\n\t\t\t// The upload progress element\n\t\t\tProgress: Element.create( 'progress', '', {\n\t\t\t\tvalue: '0',\n\t\t\t\tmax: '100'\n\t\t\t} ),\n\n\t\t\t// The upload progress wrapper element\n\t\t\tProgressWrapper: Element.create( 'span' ),\n\n\t\t\t// The pseudo element containing the CSV values that will be posted\n\t\t\tPseudo: Element.create( 'input', '', {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tname: name,\n\t\t\t\tvalue: ''\n\t\t\t} ),\n\n\t\t\tWrapper: document.getElementById( id )\n\t\t};\n\t\tthis.events = {};\n\t\tthis.queue = [];\n\t\tthis.queueCount = 0;\n\t\tthis.queueSize = 0;\n\t\tthis.queueUploadedCount = 0;\n\t\tthis.queueUploadedSize = 0;\n\t\tthis.request = new XMLHttpRequest();\n\t\tthis.uploaded = [];\n\t\tthis.uri = '/' + uri.replace( /^\\//, '' ).replace( /\\/$/, '' );\n\n\t\tthis.addMarkup();\n\t\tthis.addDragAndDropListeners();\n\n\t\tif( uploadSupported ) {\n\t\t\tthis.elements.Input.addEventListener( 'change', ( e, files ) => {\n\t\t\t\tthis.upload( e, files );\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.hideProgress();\n\n\t\t\tconsole.warn( 'Browser does not support AJAX uploading' );\n\t\t}\n\t}\n\n\tstatic prettySize( intBytes ) {\n\t\tlet arrLimits = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],\n\t\t\t\tintLimit = 0;\n\n\t\twhile( arrLimits[intLimit] && intBytes > Math.pow( 1024, intLimit + 1 ) ) {\n\t\t\tintLimit++;\n\t\t}\n\n\t\treturn this.round( intBytes / Math.pow( 1024, intLimit ), ( intLimit > 1 ? 2 : 0 ) ) + arrLimits[intLimit];\n\t}\n\n\tstatic round( intNumber, intDP = 0 ) {\n\t\treturn intDP === 0 ? parseInt( Math.round( intNumber * Math.pow( 10, intDP ) ) / Math.pow( 10, intDP ) ) : parseFloat( Math.round( intNumber * Math.pow( 10, intDP ) ) / Math.pow( 10, intDP ) );\n\t}\n\n\taddMarkup() {\n\t\tthis.elements.ProgressWrapper.appendChild( this.elements.Progress );\n\t\tthis.elements.ProgressWrapper.appendChild( this.elements.CancelUpload );\n\t\tif( this.settings.multiple ) {\n\t\t\tthis.elements.CountWrapper.appendChild( this.elements.Count );\n\t\t\tthis.elements.CountWrapper.insertAdjacentHTML( 'beforeend', '/' );\n\t\t\tthis.elements.CountWrapper.appendChild( this.elements.CountTotal );\n\t\t\tthis.elements.ProgressWrapper.appendChild( this.elements.CountWrapper );\n\t\t}\n\t\tthis.elements.Wrapper.appendChild( this.elements.Input );\n\t\tthis.elements.Wrapper.appendChild( this.elements.Pseudo );\n\t\tthis.elements.Wrapper.appendChild( this.elements.ProgressWrapper );\n\t\tthis.elements.Wrapper.appendChild( this.elements.List );\n\n\t\tthis.hideProgress();\n\t}\n\n\taddDragAndDropListeners() {\n\t\tlet dropArea = this.elements.Wrapper;\n\t\tlet possibleDropArea = this.settings.dragdrop ? document.querySelectorAll( this.settings.dragdrop ) : [];\n\n\t\tif( possibleDropArea.length ) {\n\t\t\tdropArea = possibleDropArea[0];\n\t\t}\n\n\t\tdropArea.addEventListener( 'dragover', e => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log( 'DRAG OVER' )\n\t\t\tdropArea.classList.add( this.settings.dragdrophoverclass );\n\t\t}, false );\n\t\tdropArea.addEventListener( 'dragleave', e => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log( 'DRAG LEAVE' )\n\t\t\tdropArea.classList.remove( this.settings.dragdrophoverclass );\n\t\t}, false );\n\t\tdropArea.addEventListener( 'drop', e => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.upload( e, e.target.files || e.dataTransfer.files );\n\t\t\tdropArea.classList.remove( this.settings.dragdrophoverclass );\n\t\t}, false );\n\t}\n\n\tupload( e, arrFiles ) {\n\t\ttry {\n\t\t\tif( e ) {\n\t\t\t\tlet resFiles = ( !arrFiles ? ( e.target || e.srcElement ).files : arrFiles );\n\n\t\t\t\tthis.queue.push.apply( this.queue, resFiles );\n\t\t\t\tthis.queueCount += resFiles.length;\n\n\t\t\t\tfor( let intFile = 0, intFiles = resFiles.length; intFile < intFiles; intFile++ ) {\n\t\t\t\t\tthis.queueSize += parseInt( resFiles[intFile].size );\n\t\t\t\t}\n\n\t\t\t\tif( this.elements.CountTotal ) {\n\t\t\t\t\tthis.elements.CountTotal.innerText = this.queueCount;\n\t\t\t\t}\n\n\t\t\t\t//console.log( 'Added ' + resFiles.length + ' files to the queue', 'info' );\n\t\t\t}\n\n\t\t\tif( this.queue.length ) {\n\t\t\t\tlet resFile = this.queue[0],\n\t\t\t\t\t\tstrFileName = resFile.name,\n\t\t\t\t\t\tstrFileType = resFile.type,\n\t\t\t\t\t\tstrFileExtention = strFileName.substr( strFileName.lastIndexOf( '.' ) + 1 ).toLowerCase(),\n\t\t\t\t\t\tintFileSize = parseInt( resFile.size ),\n\t\t\t\t\t\tresFileReader = new FileReader( {blob: true} ),\n\t\t\t\t\t\tblAcceptedType = !this.settings.acceptTypes.length && !this.settings.acceptExtensions.length;\n\n\t\t\t\tif( !blAcceptedType ) {\n\t\t\t\t\tfor( let type of this.settings.acceptTypes ) {\n\t\t\t\t\t\tif( new RegExp( '^' + type.replace( '*', '.*' ) + '$', 'gi' ).test( strFileType ) ) {\n\t\t\t\t\t\t\tblAcceptedType = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif( !blAcceptedType ) {\n\t\t\t\t\tif( this.settings.acceptExtensions.indexOf( '.' + strFileExtention ) !== -1 ) {\n\t\t\t\t\t\tblAcceptedType = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfor( let extention of this.settings.acceptExtensions ) {\n\n\t\t\t\t\t\tif( strFileExtention === extention ) {\n\t\t\t\t\t\t\tblAcceptedType = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif( blAcceptedType ) {\n\t\t\t\t\tthis.settings.onstart( resFile );\n\t\t\t\t\tthis.showProgress();\n\n\t\t\t\t\tif( this.elements.Count ) {\n\t\t\t\t\t\tthis.elements.Count.innerText = this.queueUploadedCount + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( this.queueCount === 1 ) {\n\t\t\t\t\t\tif( this.elements.Progress ) {\n\t\t\t\t\t\t\tthis.elements.Progress.removeAttribute( 'value' );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnew Element( this.elements.CountWrapper ).hide();\n\t\t\t\t\t} else if( this.elements.CountWrapper ) {\n\t\t\t\t\t\tnew Element( this.elements.CountWrapper ).show();\n\t\t\t\t\t}\n\n\t\t\t\t\tresFileReader.addEventListener( 'load',\n\t\t\t\t\t\t\te => {\n\t\t\t\t\t\t\t\tthis.request.onreadystatechange = () => {\n\t\t\t\t\t\t\t\t\tswitch( this.request.status ) {\n\t\t\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t\t\t\tif( this.request.readyState === 4 ) {\n\t\t\t\t\t\t\t\t\t\t\t\t//console.info( 'Uploaded ' + strFileName + ' (' + twistfileupload.prettySize( intFileSize ) + ')' );\n\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount++;\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize += intFileSize;\n\n\t\t\t\t\t\t\t\t\t\t\t\tlet jsonResponse = JSON.parse( this.request.responseText );\n\n\t\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( this.settings.multiple ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded.push( jsonResponse );\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded = [jsonResponse.form_value];\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.updateUploadedList();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( window.twist.debug ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.twist.debug.logFileUpload( resFile, jsonResponse );\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletefile( jsonResponse, resFile );\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t//console.info( 'Finished uploading ' + this.queueUploadedCount + ' files (' + twistfileupload.prettySize( this.queueUploadedSize ) + ')', 'info' );\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.clearInput();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( this.settings.multiple ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded.push( jsonResponse );\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded = [jsonResponse];\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.updateUploadedList();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( window.twist.debug ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.twist.debug.logFileUpload( resFile, jsonResponse );\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletefile( jsonResponse, resFile );\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletequeue();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 403:\n\t\t\t\t\t\t\t\t\t\t\tconsole.error( 'Permission denied' );\n\n\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\n\t\t\t\t\t\t\t\t\t\t\tthis.queueCount--;\n\t\t\t\t\t\t\t\t\t\t\tthis.queueSize--;\n\n\t\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\n\n\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 404:\n\t\t\t\t\t\t\t\t\t\t\tconsole.error( 'Invalid function call' );\n\n\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\n\t\t\t\t\t\t\t\t\t\t\tthis.queueCount--;\n\t\t\t\t\t\t\t\t\t\t\tthis.queueSize--;\n\n\t\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\n\n\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tthis.request.onprogress = e => {\n\t\t\t\t\t\t\t\t\tif( e.lengthComputable ) {\n\t\t\t\t\t\t\t\t\t\tif( this.elements.Progress ) {\n\t\t\t\t\t\t\t\t\t\t\tlet intPercentage = Math.round( ( e.loaded / e.total ) * 100 );\n\t\t\t\t\t\t\t\t\t\t\tthis.elements.Progress.value = intPercentage;\n\n\t\t\t\t\t\t\t\t\t\t\t//console.log( twistfileupload.prettySize( e.loaded ) + '/' + twistfileupload.prettySize( e.total ) + ' (' + intPercentage + '%)' );\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tthis.settings.onprogress( resFile, e.loaded, e.total );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tthis.request.upload.onprogress = this.request.onprogress;\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'load', () => {}, false );\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'error', () => {\n\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\n\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\n\n\t\t\t\t\t\t\t\t\t\tthis.queue = [];\n\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\n\n\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\n\n\t\t\t\t\t\t\t\t\t\tconsole.error( 'An error occurred' );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, false );\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'abort', () => {\n\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\n\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\n\n\t\t\t\t\t\t\t\t\t\tthis.queue = [];\n\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\n\n\t\t\t\t\t\t\t\t\t\tthis.settings.onabort( resFile );\n\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'Upload aborted' );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, false );\n\t\t\t\t\t\t\t\tthis.request.open( 'PUT', this.uri, true );\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Accept', '\"text/plain; charset=iso-8859-1\", \"Content-Type\": \"text/plain; charset=iso-8859-1\"' );\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-File', strFileName );\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-Length', intFileSize );\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-UID', this.id );\n\t\t\t\t\t\t\t\tthis.request.send( resFileReader.result );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tresFileReader.readAsArrayBuffer( resFile );\n\t\t\t\t} else {\n\t\t\t\t\tlet objInvalidFile = this.queue.shift();\n\t\t\t\t\tthis.elements.Input.value = '';\n\n\t\t\t\t\tthis.settings.oninvalidtype( objInvalidFile, this.settings.acceptTypes, this.settings.acceptExtensions );\n\n\t\t\t\t\tconsole.error( strFileName + ' (' + strFileType + ') is not in the list of allowed types or extensions' );\n\n\t\t\t\t\tif( this.settings.acceptTypes.length ) {\n\t\t\t\t\t\tconsole.info( 'Allowed MIME types: ' + this.settings.acceptTypes.join( ', ' ) );\n\t\t\t\t\t}\n\n\t\t\t\t\tif( this.settings.acceptExtensions.length ) {\n\t\t\t\t\t\tconsole.info( 'Allowed file extensions: ' + this.settings.acceptExtensions.join( ', ' ) );\n\t\t\t\t\t}\n\n\t\t\t\t\t//alert( this.settings.invalidtypemessage ); //TODO: Handle this without using alert()\n\n\t\t\t\t\tthis.clearInput();\n\t\t\t\t}\n\t\t\t}\n\t\t} catch( err ) {\n\t\t\tthis.hideProgress();\n\n\t\t\tthis.settings.onerror( this.queue[0] );\n\t\t\tthis.settings.onabort( this.queue[0] );\n\n\t\t\tthis.queue = [];\n\t\t\tthis.queueCount = 0;\n\t\t\tthis.queueSize = 0;\n\t\t\tthis.queueUploadedCount = 0;\n\t\t\tthis.queueUploadedSize = 0;\n\n\t\t\tconsole.error( err );\n\t\t}\n\t}\n\n\tshowProgress() {\n\t\tnew Element( this.elements.Input ).hide();\n\t\tnew Element( this.elements.ProgressWrapper ).show();\n\n\t\tif( this.elements.CancelUpload ) {\n\t\t\tthis.elements.CancelUpload.addEventListener( 'click', () => { this.cancelUpload() } );\n\t\t}\n\t}\n\n\thideProgress() {\n\t\tnew Element( this.elements.Input ).show();\n\t\tnew Element( this.elements.ProgressWrapper ).hide();\n\n\t\tif( this.elements.CancelUpload ) {\n\t\t\tthis.elements.CancelUpload.removeEventListener( 'click', () => { this.cancelUpload() } );\n\t\t}\n\t}\n\n\tclearInput() {\n\t\tthis.elements.Input.value = '';\n\n\t\tif( this.elements.Input.value ) {\n\t\t\tthis.elements.Input.type = 'text';\n\t\t\tthis.elements.Input.type = 'file';\n\t\t}\n\n\t\tthis.elements.Pseudo.value = '';\n\t\tthis.settings.onclear();\n\t}\n\n\tcancelUpload() {\n\t\tthis.request.abort();\n\t\tthis.clearInput();\n\t}\n\n\tupdateUploadedList() {\n\t\tlet arrUploadedFormValues = [];\n\n\t\tthis.elements.List.innerHTML = '';\n\n\t\t//console.log( this.uploaded );\n\n\t\tfor( let objUploadedFile of this.uploaded ) {\n\t\t\tlet strFilePreview = objUploadedFile.uri_preview,\n\t\t\t\t\tstrFileDetails = '',\n\t\t\t\t\tarrFileDetails = ['file/name', 'file/size', 'file_type'],\n\t\t\t\t\tstrPreview = 'thumb-' + this.settings.previewsize;\n\n\t\t\tarrUploadedFormValues.push( objUploadedFile.form_value );\n\n\t\t\tif( this.settings.previewsquare ) {\n\t\t\t\tstrPreview = 'square-' + strPreview;\n\t\t\t}\n\n\t\t\tif( objUploadedFile.support &&\n\t\t\t\t\tobjUploadedFile.support[strPreview] ) {\n\t\t\t\tstrFilePreview = objUploadedFile.support[strPreview];\n\t\t\t}\n\n\t\t\tfor( let intFileDetail in arrFileDetails ) {\n\t\t\t\tlet strFileDetail = arrFileDetails[intFileDetail],\n\t\t\t\t\t\tstrProperty;\n\n\t\t\t\tif( strFileDetail.indexOf( '/' ) !== -1 ) {\n\t\t\t\t\tlet arrDelve = strFileDetail.split( '/' ),\n\t\t\t\t\t\t\tobjToDelve = objUploadedFile[arrDelve[0]] || null;\n\n\t\t\t\t\tarrDelve.shift();\n\n\t\t\t\t\tif( objToDelve ) {\n\t\t\t\t\t\tfor( let intKeyPart in arrDelve ) {\n\t\t\t\t\t\t\tobjToDelve = objToDelve[arrDelve[intKeyPart]] || null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstrProperty = objToDelve || null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstrProperty = objUploadedFile[strFileDetail] || null;\n\t\t\t\t}\n\n\t\t\t\tstrFileDetails += '<li data-key=\"' + strFileDetail + '\"><span>' + strFileDetail.replace( /[\\/_]/g, ' ' ) + ' :</span>' + strProperty + '</li>';\n\t\t\t}\n\n\t\t\tlet listItem = Element.create( 'li', 'twistupload-file-list-item' ),\n\t\t\t\t\tlistItemPreview = Element.create( 'img', '', {src: strFilePreview} ),\n\t\t\t\t\tlistItemInfo = Element.create( 'ul', 'twistupload-file-list-item-info', {}, strFileDetails ),\n\t\t\t\t\tlistItemRemoveButton = Element.create( 'button', '', {}, 'Remove' );\n\n\t\t\tlistItemRemoveButton.addEventListener( 'click', (fileToRemove => {\n\t\t\t\treturn () => {\n\t\t\t\t\tthis.uploaded.splice( this.uploaded.indexOf( fileToRemove ), 1 );\n\t\t\t\t\tthis.updateUploadedList();\n\t\t\t\t}\n\t\t\t})( objUploadedFile ) );\n\n\t\t\tlistItem.appendChild( listItemPreview );\n\t\t\tlistItem.appendChild( listItemInfo );\n\t\t\tlistItem.appendChild( listItemRemoveButton );\n\n\t\t\tthis.elements.List.appendChild( listItem );\n\t\t}\n\n\t\tthis.elements.Pseudo.value = JSON.stringify( arrUploadedFormValues );\n\t}\n\n\ton( event, action, context = null ) {\n\t\t//TODO\n\t}\n\n\toff( event, action ) {\n\t\t//TODO\n\t}\n\n\ttrigger( event ) {\n\t\t//TODO\n\t}\n}\n"],"names":["Element","el","this","toggle","show","value","getAttribute","display","style","computedDisplay","window","getComputedStyle","currentStyle","defaultDisplay","nodeName","setAttribute","tag","classes","attributes","html","document","createElement","className","join","e","attribute","hasOwnProperty","innerHTML","id","uri","name","settings","uploadSupported","XMLHttpRequest","responseType","requestTest","open","Object","assign","elements","create","_this","acceptTypes","concat","acceptExtensions","multiple","getElementById","events","queue","queueCount","queueSize","queueUploadedCount","queueUploadedSize","request","uploaded","replace","addMarkup","addDragAndDropListeners","Input","addEventListener","files","upload","hideProgress","warn","ProgressWrapper","appendChild","Progress","CancelUpload","CountWrapper","Count","insertAdjacentHTML","CountTotal","Wrapper","Pseudo","List","dropArea","possibleDropArea","dragdrop","querySelectorAll","length","stopPropagation","preventDefault","log","classList","add","_this2","dragdrophoverclass","remove","target","dataTransfer","arrFiles","resFiles","srcElement","push","apply","intFile","intFiles","parseInt","size","innerText","resFile","strFileName","strFileType","type","strFileExtention","substr","lastIndexOf","toLowerCase","intFileSize","resFileReader","FileReader","blob","blAcceptedType","RegExp","test","indexOf","onstart","showProgress","removeAttribute","hide","onreadystatechange","_this3","status","readyState","shift","jsonResponse","JSON","parse","responseText","form_value","updateUploadedList","twist","debug","logFileUpload","oncompletefile","clearInput","oncompletequeue","error","onerror","onprogress","lengthComputable","intPercentage","Math","round","loaded","total","onabort","setRequestHeader","send","result","readAsArrayBuffer","objInvalidFile","oninvalidtype","info","err","cancelUpload","removeEventListener","onclear","abort","arrUploadedFormValues","objUploadedFile","strFilePreview","uri_preview","strFileDetails","arrFileDetails","strPreview","previewsize","intFileDetail","previewsquare","support","strFileDetail","strProperty","arrDelve","split","objToDelve","intKeyPart","listItem","listItemPreview","src","listItemInfo","listItemRemoveButton","splice","_this6","fileToRemove","stringify","event","action","intBytes","arrLimits","intLimit","pow","intNumber","intDP","parseFloat"],"mappings":"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"}