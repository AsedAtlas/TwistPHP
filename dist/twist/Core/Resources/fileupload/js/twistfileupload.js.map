{"version":3,"file":"twistfileupload.js","sources":["../../../../../../src/fileupload/js/twistfileupload.js"],"sourcesContent":["/*!\r\n * TwistPHP - An open source PHP MVC framework built from the ground up.\r\n * Shadow Technologies Ltd.\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n * @author     Shadow Technologies Ltd. <contact@shadow-technologies.co.uk>\r\n * @license    https://www.gnu.org/licenses/gpl.html GPL License\r\n * @link       https://twistphp.com\r\n */\r\n\r\nclass Element {\r\n\tconstructor( el ) {\r\n\t\tthis.el = el;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tstatic create( tag, classes = [], attributes = {}, html = '' ) {\r\n\t\tconst el = document.createElement( tag );\r\n\r\n\t\tif( classes ) {\r\n\t\t\ttry {\r\n\t\t\t\tel.className = classes.join( ' ' );\r\n\t\t\t} catch( e ) {\r\n\t\t\t\tif( typeof classes === 'string' ) {\r\n\t\t\t\t\tel.className = classes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( attributes ) {\r\n\t\t\tfor( let attribute in attributes ) {\r\n\t\t\t\tif( attributes.hasOwnProperty( attribute ) ) {\r\n\t\t\t\t\tel.setAttribute( attribute, attributes[attribute] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( html ) {\r\n\t\t\tel.innerHTML = html;\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.toggle( true );\r\n\t}\r\n\r\n\thide() {\r\n\t\tthis.toggle();\r\n\t}\r\n\r\n\ttoggle( show ) {\r\n\t\tlet value = this.el.getAttribute( 'data-initialdisplay' );\r\n\t\tlet display = this.el.style.display;\r\n\t\tlet computedDisplay = (window.getComputedStyle ? getComputedStyle( this.el, null ) : this.el.currentStyle).display;\r\n\r\n\t\tif( show ) {\r\n\t\t\tif( !value &&\r\n\t\t\t\t\tdisplay === 'none' ) {\r\n\t\t\t\tthis.el.style.display = '';\r\n\t\t\t}\r\n\t\t\tif( this.el.style.display === '' &&\r\n\t\t\t\t\tcomputedDisplay === 'none' ) {\r\n\t\t\t\tvalue = value || defaultDisplay( this.el.nodeName );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( display &&\r\n\t\t\t\t\tdisplay !== 'none'\r\n\t\t\t\t\t|| !(computedDisplay === 'none') ) {\r\n\t\t\t\tthis.el.setAttribute( 'data-initialdisplay', (computedDisplay === 'none') ? display : computedDisplay );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( !show ||\r\n\t\t\t\tthis.el.style.display === 'none' ||\r\n\t\t\t\tthis.el.style.display === '' ) {\r\n\t\t\tthis.el.style.display = show ? value || '' : 'none';\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default class twistfileupload {\r\n\tconstructor( id, uri, name, settings = {} ) {\r\n\t\tlet uploadSupported = ( typeof new XMLHttpRequest().responseType === 'string' && 'withCredentials' in new XMLHttpRequest() );\r\n\r\n\t\tif( uploadSupported ) {\r\n\t\t\tlet requestTest = new XMLHttpRequest();\r\n\t\t\trequestTest.open( 'GET', '/' );\r\n\t\t\ttry {\r\n\t\t\t\trequestTest.responseType = 'arraybuffer';\r\n\t\t\t} catch( e ) {\r\n\t\t\t\tuploadSupported = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet defaultSettings = {\r\n\t\t\tabortable: true,\r\n\t\t\tacceptTypes: [],\r\n\t\t\tacceptExtensions: [],\r\n\t\t\tcounter: true,\r\n\t\t\tdebug: false,\r\n\t\t\tdragdrop: null,\r\n\t\t\tdragdrophoverclass: 'twistupload-drop-hover',\r\n\t\t\thideInput: false,\r\n\t\t\tinvalidtypemessage: 'This file type is not permitted',\r\n\t\t\tmultiple: false,\r\n\t\t\tonabort: () => {},\r\n\t\t\tonclear: () => {},\r\n\t\t\toncompletefile: () => {},\r\n\t\t\toncompletequeue: () => {},\r\n\t\t\tonerror: () => {},\r\n\t\t\toninvalidtype: () => {},\r\n\t\t\tonprogress: () => {},\r\n\t\t\tonstart: () => {},\r\n\t\t\tpreviewsize: 128,\r\n\t\t\tpreviewsquare: true\r\n\t\t};\r\n\r\n\t\t//this.settings = Object.assign( {}, defaultSettings, settings );\r\n\t\tthis.settings = {};\r\n\r\n\r\n\t\tfor( let setting in defaultSettings ) {\r\n\t\t\tthis.settings[setting] = settings[setting] || defaultSettings[setting];\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\tthis.id = id;\r\n\t\tthis.elements = {\r\n\t\t\t// The cancel upload button\r\n\t\t\tCancelUpload: Element.create( 'button', '', {}, 'Cancel' ),\r\n\r\n\t\t\t// The upload count element\r\n\t\t\tCount: Element.create( 'span' ),\r\n\r\n\t\t\t// The total file count element\r\n\t\t\tCountTotal: Element.create( 'span' ),\r\n\r\n\t\t\t// The upload count wrapper element\r\n\t\t\tCountWrapper: Element.create( 'span' ),\r\n\r\n\t\t\t// The file input element\r\n\t\t\tInput: Element.create( 'input', '', (() => {\r\n\t\t\t\tlet attributes = {\r\n\t\t\t\t\ttype: 'file',\r\n\t\t\t\t\t//name: multiple ? name + '[]' : name,\r\n\t\t\t\t\taccept: this.settings.acceptTypes.concat( this.settings.acceptExtensions ).join( ',' )\r\n\t\t\t\t};\r\n\t\t\t\tif( this.settings.multiple ) {\r\n\t\t\t\t\tattributes.multiple = 'multiple';\r\n\t\t\t\t}\r\n\t\t\t\treturn attributes;\r\n\t\t\t})() ),\r\n\r\n\t\t\t// The list of uploaded files element\r\n\t\t\tList: Element.create( 'ul' ),\r\n\r\n\t\t\t// The upload progress element\r\n\t\t\tProgress: Element.create( 'progress', '', {\r\n\t\t\t\tvalue: '0',\r\n\t\t\t\tmax: '100'\r\n\t\t\t} ),\r\n\r\n\t\t\t// The upload progress wrapper element\r\n\t\t\tProgressWrapper: Element.create( 'span' ),\r\n\r\n\t\t\t// The pseudo element containing the CSV values that will be posted\r\n\t\t\tPseudo: Element.create( 'input', '', {\r\n\t\t\t\ttype: 'hidden',\r\n\t\t\t\tname: name,\r\n\t\t\t\tvalue: ''\r\n\t\t\t} ),\r\n\r\n\t\t\tWrapper: document.getElementById( id )\r\n\t\t};\r\n\t\tthis.events = {};\r\n\t\tthis.queue = [];\r\n\t\tthis.queueCount = 0;\r\n\t\tthis.queueSize = 0;\r\n\t\tthis.queueUploadedCount = 0;\r\n\t\tthis.queueUploadedSize = 0;\r\n\t\tthis.request = new XMLHttpRequest();\r\n\t\tthis.uploaded = [];\r\n\t\tthis.uri = '/' + uri.replace( /^\\//, '' ).replace( /\\/$/, '' );\r\n\r\n\t\tthis.addMarkup();\r\n\t\tthis.addDragAndDropListeners();\r\n\r\n\t\tif( uploadSupported ) {\r\n\t\t\tthis.elements.Input.addEventListener( 'change', ( e, files ) => {\r\n\t\t\t\tthis.upload( e, files );\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tthis.hideProgress();\r\n\r\n\t\t\tconsole.warn( 'Browser does not support AJAX uploading' );\r\n\t\t}\r\n\t}\r\n\r\n\tstatic prettySize( intBytes ) {\r\n\t\tlet arrLimits = ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\r\n\t\tlet intLimit = 0;\r\n\r\n\t\twhile( arrLimits[intLimit] && intBytes > Math.pow( 1024, intLimit + 1 ) ) {\r\n\t\t\tintLimit++;\r\n\t\t}\r\n\r\n\t\treturn this.round( intBytes / Math.pow( 1024, intLimit ), ( intLimit > 1 ? 2 : 0 ) ) + arrLimits[intLimit];\r\n\t}\r\n\r\n\tstatic round( intNumber, intDP = 0 ) {\r\n\t\treturn intDP === 0 ? parseInt( Math.round( intNumber * Math.pow( 10, intDP ) ) / Math.pow( 10, intDP ) ) : parseFloat( Math.round( intNumber * Math.pow( 10, intDP ) ) / Math.pow( 10, intDP ) );\r\n\t}\r\n\r\n\taddMarkup() {\r\n\t\tthis.elements.ProgressWrapper.appendChild( this.elements.Progress );\r\n\t\tthis.elements.ProgressWrapper.appendChild( this.elements.CancelUpload );\r\n\t\tif( this.settings.multiple ) {\r\n\t\t\tthis.elements.CountWrapper.appendChild( this.elements.Count );\r\n\t\t\tthis.elements.CountWrapper.insertAdjacentHTML( 'beforeend', '/' );\r\n\t\t\tthis.elements.CountWrapper.appendChild( this.elements.CountTotal );\r\n\t\t\tthis.elements.ProgressWrapper.appendChild( this.elements.CountWrapper );\r\n\t\t}\r\n\t\tthis.elements.Wrapper.appendChild( this.elements.Input );\r\n\t\tthis.elements.Wrapper.appendChild( this.elements.Pseudo );\r\n\t\tthis.elements.Wrapper.appendChild( this.elements.ProgressWrapper );\r\n\t\tthis.elements.Wrapper.appendChild( this.elements.List );\r\n\t\tif( this.settings.hideInput ) {\r\n\t\t\tnew Element( this.elements.Input ).hide();\r\n\t\t}\r\n\r\n\t\tthis.hideProgress();\r\n\t}\r\n\r\n\taddDragAndDropListeners() {\r\n\t\tlet dropArea = this.elements.Wrapper;\r\n\t\tlet possibleDropArea = this.settings.dragdrop ? document.querySelectorAll( this.settings.dragdrop ) : [];\r\n\r\n\t\tif( possibleDropArea.length ) {\r\n\t\t\tdropArea = possibleDropArea[0];\r\n\t\t}\r\n\r\n\t\tdropArea.addEventListener( 'dragover', e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\t\t\tconsole.log( 'DRAG OVER' )\r\n\t\t\tdropArea.classList.add( this.settings.dragdrophoverclass );\r\n\t\t}, false );\r\n\t\tdropArea.addEventListener( 'dragleave', e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\t\t\tconsole.log( 'DRAG LEAVE' )\r\n\t\t\tdropArea.classList.remove( this.settings.dragdrophoverclass );\r\n\t\t}, false );\r\n\t\tdropArea.addEventListener( 'drop', e => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.upload( e, e.target.files || e.dataTransfer.files );\r\n\t\t\tdropArea.classList.remove( this.settings.dragdrophoverclass );\r\n\t\t}, false );\r\n\t}\r\n\r\n\tupload( e, arrFiles ) {\r\n\t\ttry {\r\n\t\t\tif( e ) {\r\n\t\t\t\tlet resFiles = ( !arrFiles ? ( e.target || e.srcElement ).files : arrFiles );\r\n\r\n\t\t\t\tthis.queue.push.apply( this.queue, resFiles );\r\n\t\t\t\tthis.queueCount += resFiles.length;\r\n\r\n\t\t\t\tfor( let intFile = 0, intFiles = resFiles.length; intFile < intFiles; intFile++ ) {\r\n\t\t\t\t\tthis.queueSize += parseInt( resFiles[intFile].size );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( this.elements.CountTotal ) {\r\n\t\t\t\t\tthis.elements.CountTotal.innerText = this.queueCount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//console.log( 'Added ' + resFiles.length + ' files to the queue', 'info' );\r\n\t\t\t}\r\n\r\n\t\t\tif( this.queue.length ) {\r\n\t\t\t\tlet resFile = this.queue[0];\r\n\t\t\t\tlet strFileName = resFile.name;\r\n\t\t\t\tlet strFileType = resFile.type;\r\n\t\t\t\tlet strFileExtention = strFileName.substr( strFileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\r\n\t\t\t\tlet intFileSize = parseInt( resFile.size );\r\n\t\t\t\tlet resFileReader = new FileReader( {blob: true} );\r\n\t\t\t\tlet blAcceptedType = !this.settings.acceptTypes.length && !this.settings.acceptExtensions.length;\r\n\r\n\t\t\t\tif( !blAcceptedType ) {\r\n\t\t\t\t\tfor( let typeIndex in this.settings.acceptTypes ) {\r\n\t\t\t\t\t\tlet type = this.settings.acceptTypes[typeIndex];\r\n\t\t\t\t\t\tif( new RegExp( '^' + type.replace( '*', '.*' ) + '$', 'gi' ).test( strFileType ) ) {\r\n\t\t\t\t\t\t\tblAcceptedType = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( !blAcceptedType ) {\r\n\t\t\t\t\tif( this.settings.acceptExtensions.indexOf( '.' + strFileExtention ) !== -1 ) {\r\n\t\t\t\t\t\tblAcceptedType = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor( let extentionIndex in this.settings.acceptExtensions ) {\r\n\t\t\t\t\t\tlet extention = this.settings.acceptExtensions[extentionIndex]\r\n\t\t\t\t\t\tif( strFileExtention === extention ) {\r\n\t\t\t\t\t\t\tblAcceptedType = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( blAcceptedType ) {\r\n\t\t\t\t\tthis.settings.onstart( resFile );\r\n\t\t\t\t\tthis.showProgress();\r\n\r\n\t\t\t\t\tif( this.elements.Count ) {\r\n\t\t\t\t\t\tthis.elements.Count.innerText = this.queueUploadedCount + 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif( this.queueCount === 1 ) {\r\n\t\t\t\t\t\tif( this.elements.Progress ) {\r\n\t\t\t\t\t\t\tthis.elements.Progress.removeAttribute( 'value' );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnew Element( this.elements.CountWrapper ).hide();\r\n\t\t\t\t\t} else if( this.elements.CountWrapper ) {\r\n\t\t\t\t\t\tnew Element( this.elements.CountWrapper ).show();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresFileReader.addEventListener( 'load', e => {\r\n\t\t\t\t\t\t\t\tthis.request.onreadystatechange = () => {\r\n\t\t\t\t\t\t\t\t\tswitch( this.request.status ) {\r\n\t\t\t\t\t\t\t\t\t\tcase 200:\r\n\t\t\t\t\t\t\t\t\t\t\tif( this.request.readyState === 4 ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t//console.info( 'Uploaded ' + strFileName + ' (' + twistfileupload.prettySize( intFileSize ) + ')' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize += intFileSize;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet jsonResponse = JSON.parse( this.request.responseText );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( this.settings.multiple ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded.push( jsonResponse );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded = [jsonResponse.form_value];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.updateUploadedList();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( window.twist && window.twist.debug ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.twist.debug.logFileUpload( resFile, jsonResponse );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletefile( jsonResponse, resFile );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t//console.info( 'Finished uploading ' + this.queueUploadedCount + ' files (' + twistfileupload.prettySize( this.queueUploadedSize ) + ')', 'info' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.clearInput();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( this.settings.multiple ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded.push( jsonResponse );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.uploaded = [jsonResponse];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.updateUploadedList();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif( window.twist && window.twist.debug ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.twist.debug.logFileUpload( resFile, jsonResponse );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletefile( jsonResponse, resFile );\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.settings.oncompletequeue();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 403:\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.error( 'Permission denied' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queueCount--;\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queueSize--;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\t\tcase 404:\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.error( 'Invalid function call' );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queue.shift();\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queueCount--;\r\n\t\t\t\t\t\t\t\t\t\t\tthis.queueSize--;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.upload();\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tthis.request.onprogress = e => {\r\n\t\t\t\t\t\t\t\t\tif( e.lengthComputable ) {\r\n\t\t\t\t\t\t\t\t\t\tif( this.elements.Progress ) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet intPercentage = Math.round( ( e.loaded / e.total ) * 100 );\r\n\t\t\t\t\t\t\t\t\t\t\tthis.elements.Progress.value = intPercentage;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t//console.log( twistfileupload.prettySize( e.loaded ) + '/' + twistfileupload.prettySize( e.total ) + ' (' + intPercentage + '%)' );\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.settings.onprogress( resFile, e.loaded, e.total );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tthis.request.upload.onprogress = this.request.onprogress;\r\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'load', () => {}, false );\r\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'error', () => {\r\n\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\r\n\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.queue = [];\r\n\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.settings.onerror( resFile );\r\n\r\n\t\t\t\t\t\t\t\t\t\tconsole.error( 'An error occurred' );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}, false );\r\n\t\t\t\t\t\t\t\tthis.request.addEventListener( 'abort', () => {\r\n\t\t\t\t\t\t\t\t\tif( this.queue.length ) {\r\n\t\t\t\t\t\t\t\t\t\tthis.hideProgress();\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.queue = [];\r\n\t\t\t\t\t\t\t\t\t\tthis.queueCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueSize = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tthis.queueUploadedSize = 0;\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.settings.onabort( resFile );\r\n\r\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'Upload aborted' );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}, false );\r\n\t\t\t\t\t\t\t\tthis.request.open( 'PUT', this.uri, true );\r\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Accept', '\"text/plain; charset=iso-8859-1\", \"Content-Type\": \"text/plain; charset=iso-8859-1\"' );\r\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-File', strFileName );\r\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-Length', intFileSize );\r\n\t\t\t\t\t\t\t\tthis.request.setRequestHeader( 'Twist-UID', this.id );\r\n\t\t\t\t\t\t\t\tthis.request.send( resFileReader.result );\r\n\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tresFileReader.readAsArrayBuffer( resFile );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet objInvalidFile = this.queue.shift();\r\n\t\t\t\t\tthis.elements.Input.value = '';\r\n\r\n\t\t\t\t\tthis.settings.oninvalidtype( objInvalidFile, this.settings.acceptTypes, this.settings.acceptExtensions );\r\n\r\n\t\t\t\t\tconsole.error( strFileName + ' (' + strFileType + ') is not in the list of allowed types or extensions' );\r\n\r\n\t\t\t\t\tif( this.settings.acceptTypes.length ) {\r\n\t\t\t\t\t\tconsole.info( 'Allowed MIME types: ' + this.settings.acceptTypes.join( ', ' ) );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif( this.settings.acceptExtensions.length ) {\r\n\t\t\t\t\t\tconsole.info( 'Allowed file extensions: ' + this.settings.acceptExtensions.join( ', ' ) );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//alert( this.settings.invalidtypemessage ); //TODO: Handle this without using alert()\r\n\r\n\t\t\t\t\tthis.clearInput();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch( err ) {\r\n\t\t\tthis.hideProgress();\r\n\r\n\t\t\tthis.settings.onerror( this.queue[0] );\r\n\t\t\tthis.settings.onabort( this.queue[0] );\r\n\r\n\t\t\tthis.queue = [];\r\n\t\t\tthis.queueCount = 0;\r\n\t\t\tthis.queueSize = 0;\r\n\t\t\tthis.queueUploadedCount = 0;\r\n\t\t\tthis.queueUploadedSize = 0;\r\n\r\n\t\t\tconsole.error( err );\r\n\t\t}\r\n\t}\r\n\r\n\tshowProgress() {\r\n\t\tnew Element( this.elements.Input ).hide();\r\n\t\tnew Element( this.elements.ProgressWrapper ).show();\r\n\r\n\t\tif( this.elements.CancelUpload ) {\r\n\t\t\tthis.elements.CancelUpload.addEventListener( 'click', () => { this.cancelUpload() } );\r\n\t\t}\r\n\t}\r\n\r\n\thideProgress() {\r\n\t\tif( !this.settings.hideInput ) {\r\n\t\t\tnew Element( this.elements.Input ).show();\r\n\t\t}\r\n\t\tnew Element( this.elements.ProgressWrapper ).hide();\r\n\r\n\t\tif( this.elements.CancelUpload ) {\r\n\t\t\tthis.elements.CancelUpload.removeEventListener( 'click', () => { this.cancelUpload() } );\r\n\t\t}\r\n\t}\r\n\r\n\tclearInput() {\r\n\t\tthis.elements.Input.value = '';\r\n\r\n\t\tif( this.elements.Input.value ) {\r\n\t\t\tthis.elements.Input.type = 'text';\r\n\t\t\tthis.elements.Input.type = 'file';\r\n\t\t}\r\n\r\n\t\tthis.elements.Pseudo.value = '';\r\n\t\tthis.settings.onclear();\r\n\t}\r\n\r\n\tcancelUpload() {\r\n\t\tthis.request.abort();\r\n\t\tthis.clearInput();\r\n\t}\r\n\r\n\tupdateUploadedList() {\r\n\t\tlet arrUploadedFormValues = [];\r\n\r\n\t\tthis.elements.List.innerHTML = '';\r\n\r\n\t\t//console.log( this.uploaded );\r\n\r\n\t\tfor( let objUploadedFileIndex in this.uploaded ) {\r\n\t\t\tlet objUploadedFile = this.uploaded[objUploadedFileIndex];\r\n\t\t\tlet strFilePreview = objUploadedFile.uri_preview;\r\n\t\t\tlet strFileDetails = '';\r\n\t\t\tlet arrFileDetails = ['file/name', 'file/size', 'file_type'];\r\n\t\t\tlet strPreview = 'thumb-' + this.settings.previewsize;\r\n\r\n\t\t\tarrUploadedFormValues.push( objUploadedFile.form_value );\r\n\r\n\t\t\tif( this.settings.previewsquare ) {\r\n\t\t\t\tstrPreview = 'square-' + strPreview;\r\n\t\t\t}\r\n\r\n\t\t\tif( objUploadedFile.support &&\r\n\t\t\t\t\tobjUploadedFile.support[strPreview] ) {\r\n\t\t\t\tstrFilePreview = objUploadedFile.support[strPreview];\r\n\t\t\t}\r\n\r\n\t\t\tfor( let intFileDetail in arrFileDetails ) {\r\n\t\t\t\tlet strFileDetail = arrFileDetails[intFileDetail];\r\n\t\t\t\tlet strProperty;\r\n\r\n\t\t\t\tif( strFileDetail.indexOf( '/' ) !== -1 ) {\r\n\t\t\t\t\tlet arrDelve = strFileDetail.split( '/' );\r\n\t\t\t\t\tlet objToDelve = objUploadedFile[arrDelve[0]] || null;\r\n\r\n\t\t\t\t\tarrDelve.shift();\r\n\r\n\t\t\t\t\tif( objToDelve ) {\r\n\t\t\t\t\t\tfor( let intKeyPart in arrDelve ) {\r\n\t\t\t\t\t\t\tobjToDelve = objToDelve[arrDelve[intKeyPart]] || null;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstrProperty = objToDelve || null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstrProperty = objUploadedFile[strFileDetail] || null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstrFileDetails += '<li data-key=\"' + strFileDetail + '\"><span>' + strFileDetail.replace( /[\\/_]/g, ' ' ) + ' :</span>' + strProperty + '</li>';\r\n\t\t\t}\r\n\r\n\t\t\tlet listItem = Element.create( 'li', 'twistupload-file-list-item' );\r\n\t\t\tlet listItemPreview = Element.create( 'img', '', {src: strFilePreview} );\r\n\t\t\tlet listItemInfo = Element.create( 'ul', 'twistupload-file-list-item-info', {}, strFileDetails );\r\n\t\t\tlet listItemRemoveButton = Element.create( 'button', '', {}, 'Remove' );\r\n\r\n\t\t\tlistItemRemoveButton.addEventListener( 'click', (fileToRemove => {\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\tthis.uploaded.splice( this.uploaded.indexOf( fileToRemove ), 1 );\r\n\t\t\t\t\tthis.updateUploadedList();\r\n\t\t\t\t}\r\n\t\t\t})( objUploadedFile ) );\r\n\r\n\t\t\tlistItem.appendChild( listItemPreview );\r\n\t\t\tlistItem.appendChild( listItemInfo );\r\n\t\t\tlistItem.appendChild( listItemRemoveButton );\r\n\r\n\t\t\tthis.elements.List.appendChild( listItem );\r\n\t\t}\r\n\r\n\t\tthis.elements.Pseudo.value = JSON.stringify( arrUploadedFormValues );\r\n\t}\r\n\r\n\ton( event, action, context = null ) {\r\n\t\t//TODO\r\n\t}\r\n\r\n\toff( event, action ) {\r\n\t\t//TODO\r\n\t}\r\n\r\n\ttrigger( event ) {\r\n\t\t//TODO\r\n\t}\r\n}\r\n"],"names":["Element","el","this","toggle","show","value","getAttribute","display","style","computedDisplay","window","getComputedStyle","currentStyle","defaultDisplay","nodeName","setAttribute","tag","classes","attributes","html","document","createElement","className","join","e","attribute","hasOwnProperty","innerHTML","id","uri","name","settings","uploadSupported","XMLHttpRequest","responseType","requestTest","open","defaultSettings","setting","elements","create","_this","acceptTypes","concat","acceptExtensions","multiple","getElementById","events","queue","queueCount","queueSize","queueUploadedCount","queueUploadedSize","request","uploaded","replace","addMarkup","addDragAndDropListeners","Input","addEventListener","files","upload","hideProgress","warn","ProgressWrapper","appendChild","Progress","CancelUpload","CountWrapper","Count","insertAdjacentHTML","CountTotal","Wrapper","Pseudo","List","hideInput","hide","dropArea","possibleDropArea","dragdrop","querySelectorAll","length","stopPropagation","preventDefault","log","classList","add","_this2","dragdrophoverclass","remove","target","dataTransfer","arrFiles","resFiles","srcElement","push","apply","intFile","intFiles","parseInt","size","innerText","resFile","strFileName","strFileType","type","strFileExtention","substr","lastIndexOf","toLowerCase","intFileSize","resFileReader","FileReader","blob","blAcceptedType","typeIndex","RegExp","test","extentionIndex","indexOf","onstart","showProgress","removeAttribute","onreadystatechange","_this3","status","readyState","shift","jsonResponse","JSON","parse","responseText","form_value","updateUploadedList","twist","debug","logFileUpload","oncompletefile","clearInput","oncompletequeue","error","onerror","onprogress","lengthComputable","intPercentage","Math","round","loaded","total","onabort","setRequestHeader","send","result","readAsArrayBuffer","objInvalidFile","oninvalidtype","info","err","cancelUpload","removeEventListener","onclear","abort","arrUploadedFormValues","objUploadedFileIndex","objUploadedFile","strFilePreview","uri_preview","strFileDetails","arrFileDetails","strPreview","previewsize","intFileDetail","previewsquare","support","strFileDetail","strProperty","arrDelve","split","objToDelve","intKeyPart","listItem","listItemPreview","src","listItemInfo","listItemRemoveButton","splice","_this6","fileToRemove","stringify","event","action","intBytes","arrLimits","intLimit","pow","intNumber","intDP","parseFloat"],"mappings":"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"}